vertical: dtf-gang-sheet
waves:
  - name: "Wave 0: Foundation"
    serial: true
    sessions:
      - topic: dtf-foundation
        stage: build
        prompt: |
          Build DTF Gang Sheet Builder foundation: schemas, constants, and mock data.

          ## What to Read First
          1. `CLAUDE.md` — project standards, coding conventions, financial arithmetic rules
          2. `docs/breadboards/dtf-gang-sheet-breadboard.md` — Data Stores (S21, S22, S25, S26), Code Affordances (N53)
          3. `lib/schemas/dtf-pricing.ts` — existing DTF sheet tier schema
          4. `lib/schemas/quote.ts` — existing serviceTypeEnum, quoteLineItemSchema
          5. `docs/shaping/dtf-gang-sheet/shaping.md` — requirements context

          ## What to Build

          ### 1. DTF Line Item Schema (`lib/schemas/dtf-line-item.ts`)
          Zod schema for DTF line items (S21 shape):
          ```typescript
          dtfLineItemSchema = z.object({
            id: z.string().uuid(),
            artworkName: z.string(),
            sizePreset: z.enum(["small", "medium", "large", "custom"]),
            width: z.number().positive(),
            height: z.number().positive(),
            quantity: z.number().int().positive(),
          })
          ```
          Export type `DtfLineItem = z.infer<typeof dtfLineItemSchema>`.

          ### 2. Sheet Calculation Schema (`lib/schemas/dtf-sheet-calculation.ts`)
          Schemas matching S22 and S24:
          - `sheetCalculationSchema`: sheets array (tier, designs, utilization), totalCost, totalSheets
          - `canvasLayoutSchema`: sheetWidth, sheetHeight, designs array (id, x, y, width, height, label), margins
          Export types: SheetCalculation, CanvasLayout.

          ### 3. DTF Constants (`lib/dtf/dtf-constants.ts`)
          - `DTF_SIZE_PRESETS` (S26): [{label:'Small/Collectibles', shortLabel:'Small', width:4, height:4}, {label:'Medium/Pocket', shortLabel:'Medium', width:6, height:6}, {label:'Large/Shirts', shortLabel:'Large', width:10, height:12}]
          - `DTF_TASK_TEMPLATE` (N53): [{name:'Gang sheet prepared'}, {name:'DTF printed'}, {name:'QC passed'}, {name:'Shipped'}]
          - `DTF_SHEET_WIDTH = 22`
          - `DTF_DEFAULT_MARGIN = 1`

          ### 4. Mock Data (`lib/mock-data.ts`)
          Add `dtfSheetTiers` array with realistic pricing:
          - 22x12" ($8.99), 22x24" ($14.99), 22x36" ($19.99), 22x48" ($24.99), 22x60" ($29.99)
          Uses existing `DTFSheetTier` type from `lib/schemas/dtf-pricing.ts`.

          ### 5. Tests (`lib/schemas/__tests__/dtf-line-item.test.ts`)
          - Valid DTF line item parses correctly
          - Rejects zero/negative width, height, quantity
          - Size preset enum validates correctly
          - Sheet calculation schema validates
          Run: `npm test`

          ## What to Produce
          - New files: dtf-line-item.ts, dtf-sheet-calculation.ts, dtf-constants.ts, test file
          - Modified: mock-data.ts (add dtfSheetTiers export)
          - All tests passing
          - KB session doc

          ## Rules
          - Use big.js for any monetary values in schemas/mock data (CRITICAL)
          - Zod-first types — no separate interfaces
          - Follow existing schema patterns in lib/schemas/

  - name: "Wave 1: Tab Architecture"
    serial: true
    sessions:
      - topic: dtf-tab-architecture
        stage: build
        dependsOn: dtf-foundation
        prompt: |
          Build ServiceTypeTabBar component and modify QuoteForm to support service type tabs.

          ## What to Read First
          1. `CLAUDE.md` — design system, coding standards, quality checklist
          2. `docs/breadboards/dtf-gang-sheet-breadboard.md` — V1 section, Connection Points, reflection note on state placement
          3. `app/(dashboard)/quotes/_components/QuoteForm.tsx` — understand full current structure
          4. `lib/schemas/dtf-line-item.ts` — DtfLineItem type (from Wave 0)
          5. `lib/schemas/dtf-sheet-calculation.ts` — SheetCalculation, CanvasLayout types (from Wave 0)

          ## What to Build

          ### 1. ServiceTypeTabBar Component (`quotes/_components/ServiceTypeTabBar.tsx`)
          Breadboard affordances: U66-U70, N40-N42, S19-S20.

          Props:
          - activeTab: ServiceType
          - enabledTypes: ServiceType[]
          - onTabSwitch: (type: ServiceType) => void
          - onAddType: (type: ServiceType) => void
          - tabValidation: Record<ServiceType, boolean>

          Features:
          - Horizontal tab bar below customer picker (U66)
          - Tab button per enabled service type with icon (U67): Monitor=SP, Layers=DTF, Scissors=Embroidery
          - Active tab underline indicator (U68) — use design system action color
          - Completion badge per tab (U69) — CheckCircle icon when valid
          - "Add Service Type" dropdown button (U70) — only shows types not already enabled
          - Embroidery always renders disabled with "Coming soon" tooltip

          ### 2. QuoteForm State Lift
          CRITICAL for R1.2 (tab switching preserves data): ALL DTF state lives in QuoteForm, NOT in DtfTabContent.

          Add to QuoteForm:
          ```typescript
          const [activeServiceTab, setActiveServiceTab] = useState<ServiceType>("screen-print")
          const [enabledServiceTypes, setEnabledServiceTypes] = useState<ServiceType[]>(["screen-print"])
          const [dtfLineItems, setDtfLineItems] = useState<DtfLineItem[]>([])
          const [sheetCalculation, setSheetCalculation] = useState<SheetCalculation | null>(null)
          const [splitMode, setSplitMode] = useState<"combine" | "split">("combine")
          const [canvasLayout, setCanvasLayout] = useState<CanvasLayout[] | null>(null)
          const [activeSheetIndex, setActiveSheetIndex] = useState(0)
          ```

          ### 3. QuoteForm Layout Modification
          - Insert ServiceTypeTabBar between customer picker and line items sections
          - Wrap existing SP line items in: `{activeServiceTab === "screen-print" && (...)}`
          - Add DTF tab placeholder: `{activeServiceTab === "dtf" && (<div>DTF content — coming next wave</div>)}`
          - Update PricingSummary: subtotal = SP subtotal + (sheetCalculation?.totalCost ?? 0)

          ## Verification
          - Tab switching works — click SP, DTF, back to SP
          - SP form data preserved across tab switches (R1.2)
          - "Add Service Type" dropdown adds DTF tab
          - Tab badges update (SP badge shows existing validation)
          - PricingSummary still calculates correctly for SP-only quotes

          ## Design Guidelines
          - Tab bar: bg-elevated, border-b border-border
          - Active tab: text-action with 2px bottom border (action color)
          - Inactive tab: text-muted-foreground, hover:text-foreground
          - Badges: 16px CheckCircle in success color
          - Spacing: py-2, gap-1 between tabs

          ## What to Produce
          - New: ServiceTypeTabBar.tsx
          - Modified: QuoteForm.tsx
          - KB session doc

  - name: "Wave 2: Parallel Feature Build"
    serial: false
    sessions:
      - topic: dtf-line-items
        stage: build
        dependsOn: dtf-tab-architecture
        prompt: |
          Build DTF line item components and wire into QuoteForm's DTF tab.

          ## What to Read First
          1. `CLAUDE.md` — design system, coding standards
          2. `docs/breadboards/dtf-gang-sheet-breadboard.md` — V2 section, UI affordances U71-U81, code affordances N43-N46, N54-N56
          3. `app/(dashboard)/quotes/_components/QuoteForm.tsx` — understand tab state from Wave 1
          4. `app/(dashboard)/quotes/_components/LineItemRow.tsx` — design pattern reference
          5. `lib/schemas/dtf-line-item.ts` — DtfLineItem type
          6. `lib/dtf/dtf-constants.ts` — DTF_SIZE_PRESETS

          ## What to Build

          ### 1. DtfLineItemRow Component (`quotes/_components/DtfLineItemRow.tsx`)
          Affordances: U73-U80, N45-N46 per row.

          Props: item: DtfLineItem, onUpdate: (id, field, value) => void, onRemove: (id) => void, canRemove: boolean

          Layout (single row, horizontal on desktop, stacked on mobile):
          - Artwork thumbnail placeholder (U74): 48x48 grey box with ImageIcon
          - Artwork name input (U73): text input, placeholder "Design name"
          - Size preset dropdown (U75): Select with DTF_SIZE_PRESETS + "Custom"
          - Custom W/H inputs (U76, U77): shown when preset = "custom", number inputs in inches
          - Dimensions display (U78): "W" x H"" text, shown when preset != "custom"
          - Quantity input (U79): number input, min=1
          - Remove button (U80): Trash2 icon, shown when canRemove

          N46 resolveDimensions: when preset dropdown changes to non-custom value, auto-set width/height from DTF_SIZE_PRESETS lookup.

          ### 2. DtfTabContent Component (`quotes/_components/DtfTabContent.tsx`)
          Container for all DTF tab content. Affordances: U71-U81 container + placeholders for V3/V4.

          Props: All DTF state from QuoteForm (lineItems, setLineItems, sheetCalculation, splitMode, setSplitMode, canvasLayout, activeSheetIndex, setActiveSheetIndex, setSheetCalculation, setCanvasLayout)

          Features:
          - DTF line item list (U71): maps dtfLineItems to DtfLineItemRow components
          - "Add Design" button (U72): Plus icon, adds empty line item (N43)
          - DTF subtotal display (U81): shows sheetCalculation?.totalCost formatted, or "--" if not calculated
          - Placeholder for SheetCalculationPanel: "Sheet calculation will appear here after designs are added"
          - Placeholder for GangSheetCanvas: hidden until canvasLayout exists

          N43 addDtfLineItem: append {id: crypto.randomUUID(), artworkName: '', width: 4, height: 4, quantity: 1, sizePreset: 'small'} (default to small preset dimensions)
          N44 removeDtfLineItem: filter by id, if sheetCalculation exists reset it to null (stale)

          ### 3. QuoteForm Wiring
          - Replace DTF tab placeholder with <DtfTabContent ... />
          - Pass all DTF state as props
          - Wire subtotal: include DTF cost in pricing summary

          ## Verification
          - Switch to DTF tab, click "Add Design" — row appears with Small preset defaults
          - Change preset to Medium — dimensions update to 6x6
          - Change to Custom — W/H inputs appear
          - Add 3 designs, switch to SP tab, switch back — all DTF data preserved
          - Remove a design — row disappears

          ## What to Produce
          - New: DtfTabContent.tsx, DtfLineItemRow.tsx
          - Modified: QuoteForm.tsx
          - KB session doc

      - topic: dtf-production-steps
        stage: build
        dependsOn: dtf-tab-architecture
        prompt: |
          Add DTF-specific production steps to job cards.

          ## What to Read First
          1. `CLAUDE.md` — project standards
          2. `docs/breadboards/dtf-gang-sheet-breadboard.md` — V5 section, N53, U93
          3. `lib/dtf/dtf-constants.ts` — DTF_TASK_TEMPLATE
          4. `lib/schemas/job.ts` — jobTaskSchema, serviceType field
          5. `lib/mock-data.ts` — find existing DTF jobs (search for serviceType: "dtf")

          ## What to Build

          ### 1. getDtfTaskTemplate Utility
          Already partially defined in `lib/dtf/dtf-constants.ts` as DTF_TASK_TEMPLATE.
          Create a function `getDtfTaskTemplate()` that returns task objects matching jobTaskSchema:
          ```typescript
          export function getDtfTaskTemplate(): Array<{
            id: string; label: string; isCompleted: boolean; isCanonical: boolean; sortOrder: number;
          }>
          ```
          Returns: Gang sheet prepared, DTF printed, QC passed, Shipped — each with unique UUID, isCompleted=false, isCanonical=true, sequential sortOrder.

          ### 2. Job Card Task Badge Rendering
          Find where job card task badges are rendered. Modify to:
          - Check `job.serviceType`
          - If "dtf": render DTF task labels
          - If "screen-print": render existing SP task labels
          - Task badges should be visually identical regardless of service type — just different labels

          ### 3. Verify Mock Data
          Check that existing DTF jobs in mock-data.ts (J-1025, J-1031, J-1034) have task labels matching DTF_TASK_TEMPLATE. If not, update mock data to use correct DTF task labels.

          ## Verification
          - Navigate to Kanban board or job list
          - DTF jobs (J-1025, J-1031, J-1034) show: Gang sheet prepared, DTF printed, QC passed, Shipped
          - SP jobs still show their original steps
          - No visual regressions

          ## What to Produce
          - Modified: dtf-constants.ts (add function), job card component(s)
          - Possibly modified: mock-data.ts
          - KB session doc

      - topic: dtf-algorithm
        stage: build
        dependsOn: dtf-foundation
        prompt: |
          Build the shelf-packing and cost optimization algorithms as pure functions with comprehensive unit tests.

          ## What to Read First
          1. `CLAUDE.md` — financial arithmetic rules (MUST use big.js for cost calculations)
          2. `docs/breadboards/dtf-gang-sheet-breadboard.md` — V3 section, algorithm details for N48 and N49
          3. `lib/schemas/dtf-line-item.ts` — DtfLineItem type
          4. `lib/schemas/dtf-sheet-calculation.ts` — SheetCalculation, CanvasLayout types
          5. `lib/schemas/dtf-pricing.ts` — DTFSheetTier type
          6. `lib/dtf/dtf-constants.ts` — DTF_SHEET_WIDTH, DTF_DEFAULT_MARGIN
          7. `lib/mock-data.ts` — dtfSheetTiers mock data
          8. `lib/helpers/money.ts` — money(), round2(), toNumber() helpers

          ## What to Build

          ### 1. Shelf-Pack Algorithm (`lib/dtf/shelf-pack.ts`)
          N48 from breadboard. Pure function, no UI dependencies.

          ```typescript
          export interface PackInput {
            id: string; width: number; height: number; quantity: number; label: string;
          }
          export interface PackedDesign {
            id: string; instanceIndex: number; x: number; y: number; width: number; height: number; label: string;
          }
          export interface PackedSheet {
            designs: PackedDesign[]; usedHeight: number; usedWidth: number;
          }
          export function shelfPack(
            designs: PackInput[],
            sheetWidth?: number, // default 22
            margin?: number,     // default 1
            mode?: "combine" | "split" // default "combine"
          ): PackedSheet[]
          ```

          Algorithm (N48 detail from breadboard):
          1. If mode="split", process each design type separately (each gets its own sheet sequence)
          2. If mode="combine", process all together
          3. Expand designs by quantity (Tiger x50 = 50 individual instances)
          4. Sort by height descending (tallest first for shelf-packing efficiency)
          5. Initialize first sheet, first shelf at y=margin
          6. For each instance:
             a. Try to place at (currentX, currentShelfY)
             b. If currentX + width + margin > sheetWidth: start new shelf (currentShelfY += tallestInShelf + margin, currentX = margin)
             c. If currentShelfY + height + margin > MAX_SHEET_LENGTH (60"): start new sheet
             d. Place design, advance currentX += width + margin
          7. Track usedHeight per sheet for tier matching
          8. Return PackedSheet[] with positioned designs

          ### 2. Cost Optimization (`lib/dtf/cost-optimize.ts`)
          N49 from breadboard. Pure function.

          ```typescript
          export interface OptimizedSheet {
            tier: DTFSheetTier; designs: PackedDesign[]; utilization: number; cost: number;
          }
          export interface SheetCalculationResult {
            sheets: OptimizedSheet[]; totalCost: number; totalSheets: number;
          }
          export function optimizeCost(
            packedSheets: PackedSheet[],
            tiers: DTFSheetTier[]
          ): SheetCalculationResult
          ```

          Algorithm (N49 detail from breadboard):
          1. Sort tiers by length ascending
          2. For each packed sheet:
             a. Find smallest tier where tier.length >= sheet.usedHeight
             b. Calculate utilization: (totalDesignArea / (sheetWidth * tier.length)) * 100
             c. Calculate cost from tier.retailPrice
          3. CRITICAL: Use big.js (via money() helper) for ALL cost arithmetic
          4. Sum total cost, count total sheets
          5. Compare against potential splits: for sheets using large tiers, check if 2 smaller tiers would be cheaper
          6. Pick minimum cost option per sheet

          ### 3. Unit Tests
          `lib/dtf/__tests__/shelf-pack.test.ts`:
          - Single small design (4x4, qty 1) → 1 sheet, design at (1, 1)
          - Row fills then wraps: three 10x10 designs on 22" sheet → 2 on first row, 1 on second
          - Sheet overflow: designs that exceed 60" height → multiple sheets
          - Split mode: 2 different designs → 2 separate sheet sequences
          - Combine mode: 2 different designs → packed together
          - Margins enforced: designs have 1" gap between them and from edges
          - Empty input → empty result
          - Large quantity: design qty 100 → fills multiple sheets correctly

          `lib/dtf/__tests__/cost-optimize.test.ts`:
          - Single sheet matches cheapest tier that fits
          - Two small sheets cheaper than one large (split wins)
          - One large cheaper than two small (combine wins)
          - Utilization calculated correctly (area-based percentage)
          - Total cost sums correctly using big.js (verify no float errors)
          - All tiers too small → picks largest available (graceful fallback)

          Run: `npm test` — all tests must pass.

          ## Rules
          - NO UI code. These are pure functions.
          - ALL cost math uses big.js via lib/helpers/money.ts
          - Export clean TypeScript interfaces for consumers
          - Maximum sheet length is 60" (largest tier from mock data)

          ## What to Produce
          - New: shelf-pack.ts, cost-optimize.ts, shelf-pack.test.ts, cost-optimize.test.ts
          - All tests passing
          - KB session doc

  - name: "Wave 3: Integration"
    serial: false
    sessions:
      - topic: dtf-calculation-ui
        stage: build
        dependsOn: dtf-algorithm
        prompt: |
          Build the SheetCalculationPanel component and wire algorithms into the DTF tab.

          ## What to Read First
          1. `CLAUDE.md` — design system, quality checklist
          2. `docs/breadboards/dtf-gang-sheet-breadboard.md` — V3 section, U82-U87, N47, N50
          3. `lib/dtf/shelf-pack.ts` — shelfPack function and types
          4. `lib/dtf/cost-optimize.ts` — optimizeCost function and types
          5. `app/(dashboard)/quotes/_components/DtfTabContent.tsx` — where to wire in
          6. `lib/mock-data.ts` — dtfSheetTiers mock data

          ## What to Build

          ### SheetCalculationPanel (`quotes/_components/SheetCalculationPanel.tsx`)
          Affordances: U82-U87, N47, N50.

          Props: lineItems, sheetCalculation, setSheetCalculation, splitMode, setSplitMode, setCanvasLayout, tiers

          UI Layout:
          - Header: "Sheet Optimization" with Calculate Layout button (U82)
          - Split/Combine toggle (U83): two radio buttons or segmented control, default "Combine"
          - Results section (shown after calculation):
            - Sheet result cards (U84): card per sheet showing tier (e.g., "22×48"), design count, price
            - Total sheets (U85): "2 sheets"
            - Total cost (U86): "$39.98" — formatted currency
            - Utilization badges (U87): percentage per sheet, color-coded:
              - >= 70%: success color
              - 40-69%: warning color
              - < 40%: error color

          N47 calculateSheetLayout:
          1. Map DtfLineItem[] to PackInput[] (id, width, height, quantity, label=artworkName)
          2. Call shelfPack(inputs, 22, 1, splitMode)
          3. Call optimizeCost(packedSheets, tiers)
          4. Set sheetCalculation state
          5. Build canvasLayout from packed positions (one CanvasLayout per sheet)
          6. Set canvasLayout state
          7. Reset activeSheetIndex to 0

          N50 recalculateOnChange: when splitMode changes AND sheetCalculation exists, re-run N47.

          Disable Calculate button when: no line items, or any line item missing artworkName/dimensions.

          ### Wire into DtfTabContent
          - Import and render SheetCalculationPanel below line items section
          - Replace placeholder text with actual component
          - Pass all relevant state props from QuoteForm

          ## Design Guidelines
          - Panel: bg-elevated rounded-lg border border-border p-4
          - Calculate button: primary variant (action color), full width on mobile, auto on desktop
          - Result cards: bg-surface rounded-md p-3, flex layout
          - Utilization badge: small pill with percentage text
          - Toggle: use RadioGroup from shadcn/ui or custom segmented control

          ## Verification
          - Add 3 DTF designs (Tiger 10x12 qty 50, Stars 4x4 qty 100, Banner 8x14 qty 25)
          - Click Calculate — results appear with sheet cards, cost, utilization
          - Toggle to Split — recalculates with different sheet count
          - Toggle back to Combine — returns to original calculation
          - Change a line item after calculation — calculation shows stale indicator or resets

          ## What to Produce
          - New: SheetCalculationPanel.tsx
          - Modified: DtfTabContent.tsx
          - KB session doc

      - topic: dtf-save-validate
        stage: build
        dependsOn: dtf-tab-architecture
        prompt: |
          Implement save/validate integration for mixed SP+DTF quotes.

          ## What to Read First
          1. `CLAUDE.md` — coding standards
          2. `docs/breadboards/dtf-gang-sheet-breadboard.md` — Connection Points, N55 mergeQuoteData, N56 validateDtfTab, N41 validateTabCompletion
          3. `app/(dashboard)/quotes/_components/QuoteForm.tsx` — full file, understand save handlers and existing validation

          ## What to Build

          ### 1. N56 validateDtfTab
          Create validation function (can be inline in QuoteForm or extracted to a helper):
          ```typescript
          function validateDtfTab(lineItems: DtfLineItem[], sheetCalculation: SheetCalculation | null): { valid: boolean; errors: string[] }
          ```
          Checks:
          - At least 1 line item with artworkName non-empty
          - Each line item: width > 0, height > 0, quantity >= 1
          - sheetCalculation exists (user has clicked Calculate)
          Return specific error messages: "Add at least one design", "Design 'X' is missing dimensions", "Calculate sheet layout before saving"

          ### 2. N41 validateTabCompletion
          For each enabled service type, run its validator:
          - "screen-print": existing validation logic (has garment, has sizes, etc.)
          - "dtf": N56 validateDtfTab
          Returns: Record<ServiceType, boolean> — feeds tab completion badges (U69)
          Call this whenever line items change, DTF items change, or calculation completes.

          ### 3. N55 mergeQuoteData
          In the save handler (existing save/saveAndSend flow):
          - If DTF tab is enabled, include DTF data in the save payload
          - Phase 1: just log/toast the merged data (no real backend)
          - Structure: { ...existingQuoteData, dtfLineItems: DtfLineItem[], sheetCalculation: SheetCalculation }

          ### 4. Save Gating
          - Can't save unless ALL enabled tabs pass validation
          - If validation fails: toast with "Complete all service type tabs before saving"
          - Highlight the first tab with errors
          - Existing SP-only flow must continue working unchanged

          ## Verification
          - SP-only quote: saves normally (regression check)
          - Add DTF tab, don't fill anything, try to save → blocked with error
          - Fill DTF designs but don't calculate → blocked: "Calculate sheet layout before saving"
          - Calculate, then save → succeeds with toast showing merged data
          - Tab badges update correctly as you fill/empty each tab

          ## What to Produce
          - Modified: QuoteForm.tsx
          - KB session doc

  - name: "Wave 4: Visual Canvas"
    serial: true
    sessions:
      - topic: dtf-canvas
        stage: build
        dependsOn: dtf-calculation-ui
        prompt: |
          Build the GangSheetCanvas component — SVG visualization of the gang sheet layout.

          ## What to Read First
          1. `CLAUDE.md` — design system, quality checklist
          2. `docs/breadboards/dtf-gang-sheet-breadboard.md` — V4 section, SVG structure from N51, U88-U92
          3. `lib/schemas/dtf-sheet-calculation.ts` — CanvasLayout type
          4. `app/(dashboard)/quotes/_components/DtfTabContent.tsx` — where to mount canvas

          ## What to Build

          ### GangSheetCanvas (`quotes/_components/GangSheetCanvas.tsx`)
          Affordances: U88-U92, N51-N52.

          Props:
          - canvasLayout: CanvasLayout[] (one per sheet)
          - activeSheetIndex: number
          - setActiveSheetIndex: (i: number) => void
          - sheetCalculation: SheetCalculation (for tier info display)

          #### N52 scaleToViewport
          - Use a ref on the container div + ResizeObserver
          - Calculate pxPerInch = containerWidth / 22 (sheet is always 22" wide)
          - Re-calculate on window resize
          - All SVG coordinates multiply physical inches by pxPerInch

          #### N51 SVG Structure (U88)
          ```jsx
          <svg viewBox={`0 0 ${width} ${height}`} className="w-full" preserveAspectRatio="xMidYMin meet">
            {/* Sheet boundary (U91) */}
            <rect x={0} y={0} width={width} height={height}
                  fill="none" stroke="var(--border)" strokeWidth={1} rx={4} />

            {/* Margin zones — subtle fill showing 1" edge margins */}
            <rect fill="rgba(255,255,255,0.03)" ... />

            {/* Design rectangles (U89) */}
            {designs.map((d, i) => (
              <g key={d.id} transform={`translate(${d.x * scale}, ${d.y * scale})`}>
                <rect width={d.width * scale} height={d.height * scale}
                      fill={DESIGN_COLORS[i % DESIGN_COLORS.length]}
                      stroke="var(--border)" strokeWidth={1} rx={2} />
                <text x={4} y={16} fill="var(--foreground)" fontSize={12} fontFamily="Inter">
                  {d.label}
                </text>
                <text x={4} y={d.height * scale - 6} fill="var(--muted-foreground)" fontSize={10}>
                  {d.width}" × {d.height}"
                </text>
              </g>
            ))}

            {/* Spacing indicators (U90) — dashed lines between adjacent designs */}
            {spacingLines.map(line => (
              <g key={line.id}>
                <line {...line} stroke="var(--muted-foreground)" strokeDasharray="4 2" strokeWidth={0.5} />
                <text fill="var(--muted-foreground)" fontSize={9}>1"</text>
              </g>
            ))}
          </svg>
          ```

          #### Design Color Palette
          Cycle through muted colors for different design types:
          ```typescript
          const DESIGN_COLORS = [
            'rgba(42, 185, 255, 0.15)',  // action/15
            'rgba(84, 202, 116, 0.15)',  // success/15
            'rgba(255, 198, 99, 0.15)',  // warning/15
            'rgba(210, 62, 8, 0.10)',    // error/10
            'rgba(147, 112, 219, 0.15)', // purple/15
          ]
          ```
          Same design type (same artworkName) gets same color across all instances.

          #### Multi-Sheet Tab Bar (U92)
          - Show tabs: "Sheet 1", "Sheet 2", etc.
          - Click switches activeSheetIndex
          - Only show when sheetCalculation.totalSheets > 1
          - Active tab: text-action, border-b action
          - Show tier dimensions next to tab label: "Sheet 1 (22×48")"

          #### Sheet Info Overlay
          - Bottom-right corner of canvas: tier dimensions, utilization percentage
          - Semi-transparent background

          ### Wire into DtfTabContent
          - Show GangSheetCanvas below SheetCalculationPanel
          - Only render when canvasLayout is not null
          - Pass activeSheetIndex state from QuoteForm

          ## Design Guidelines
          - Canvas container: bg-background border border-border rounded-lg overflow-hidden
          - Minimum canvas height: 200px; max based on sheet proportions
          - Design rects: rounded corners (rx=2), 1px border
          - Labels: Inter font, 12px for name, 10px for dimensions
          - Spacing lines: very subtle — strokeWidth 0.5, low opacity
          - The canvas should feel clean and professional, like a print preview

          ## Verification
          - After clicking Calculate, canvas appears below results
          - Designs are positioned correctly (match the algorithm output)
          - Different designs have different colors
          - Same design × multiple copies all have same color
          - Spacing indicators show 1" gaps
          - Sheet boundary visible with margin zones
          - Multi-sheet: tabs appear, switching works
          - Resize browser window — canvas scales proportionally
          - Empty state: no canvas shown before calculation

          ## What to Produce
          - New: GangSheetCanvas.tsx
          - Modified: DtfTabContent.tsx
          - KB session doc

          ## Final Demo Walkthrough
          After building, walk through the full demo:
          1. Open /quotes/new
          2. Select customer
          3. Click "Add Service Type" → DTF
          4. Switch to DTF tab
          5. Add 3 designs: Tiger 10x12 qty 50, Stars 4x4 qty 100, Banner 8x14 qty 25
          6. Click Calculate Layout
          7. See sheet cards, cost, utilization
          8. See visual canvas with positioned designs
          9. Toggle Split/Combine — see results change
          10. Switch Sheet tabs if multiple sheets
          11. Switch back to SP tab — data preserved
          12. Save quote — success
