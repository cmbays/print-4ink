---
import Layout from '../../layouts/Layout.astro';
import PageFooter from '../../components/PageFooter.astro';
import { getCollection } from 'astro:content';
import { formatDate, sortByDateDesc } from '../../lib/utils';

const strategyDocs = await getCollection('strategy');
const sorted = strategyDocs.sort(sortByDateDesc);
---

<Layout title="Strategy">
  <main class="max-w-[820px] mx-auto px-6 py-12">
    <a href="/" class="inline-flex items-center gap-1.5 text-text-muted text-sm hover:text-action transition-colors mb-8">
      <span>&larr;</span> Back to Index
    </a>

    <h1 class="text-2xl font-bold tracking-tight mb-2">Strategy</h1>
    <p class="text-text-secondary text-sm mb-8">Cooldowns, retrospectives, and strategic planning sessions</p>

    <div class="space-y-3">
      {sorted.map((doc) => {
        const dateStr = formatDate(doc.data.date);
        const isPlanning = doc.data.docType === 'planning';
        return (
          <a href={`/strategy/${doc.id}`} class="block bg-bg-elevated border border-border rounded-lg p-4 hover:border-action/30 transition-colors group">
            <div class="flex items-center gap-2 mb-1.5">
              <span class={`text-[10px] font-semibold uppercase tracking-wide px-1.5 py-0.5 rounded ${isPlanning ? 'bg-action/12 text-action' : 'bg-warning/12 text-warning'}`}>
                {doc.data.docType}
              </span>
            </div>
            <h3 class="text-sm font-semibold text-text-primary group-hover:text-action transition-colors mb-0.5">{doc.data.title}</h3>
            <p class="text-[13px] text-text-secondary line-clamp-2 mb-2">{doc.data.subtitle}</p>
            <div class="flex items-center gap-3 text-[11px] text-text-muted">
              <span>{dateStr}</span>
              <span class="opacity-40">&middot;</span>
              <span>Phase {doc.data.phase}</span>
              {doc.data.pipelinesCompleted && doc.data.pipelinesCompleted.length > 0 && (
                <>
                  <span class="opacity-40">&middot;</span>
                  <span>{doc.data.pipelinesCompleted.length} completed</span>
                </>
              )}
            </div>
          </a>
        );
      })}
    </div>

    {sorted.length === 0 && (
      <div class="text-center py-16">
        <p class="text-text-muted text-sm">No strategy docs yet.</p>
      </div>
    )}

    <PageFooter label="Strategy" />
  </main>
</Layout>
