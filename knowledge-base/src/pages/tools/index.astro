---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { pluralize } from '../../lib/utils';
import toolsConfig from '../../../../config/tools.json';

const toolDocs = await getCollection('toolDocs');
const pipelines = await getCollection('pipelines');

// Build tool cards with overview doc data and pipeline counts
const toolCards = toolsConfig.map((t) => {
  const overview = toolDocs.find((d) => d.data.tool === t.slug && d.data.docType === 'overview');
  const linkedPipelines = pipelines.filter((pl) => pl.data.tools?.includes(t.slug));
  return {
    slug: t.slug,
    label: t.label,
    subtitle: overview?.data.subtitle || '',
    status: overview?.data.status || 'draft',
    pipelineCount: linkedPipelines.length,
  };
});
---

<Layout title="Tools">
  <main class="max-w-[820px] mx-auto px-6 py-12">
    <a href="/" class="inline-flex items-center gap-1.5 text-text-muted text-sm hover:text-action transition-colors mb-8">
      <span>&larr;</span> Back to Index
    </a>

    <h1 class="text-2xl font-bold tracking-tight mb-2">Tools</h1>
    <p class="text-text-secondary text-sm mb-8">Development tools and infrastructure</p>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
      {toolCards.map((t) => (
        <a href={`/tools/${t.slug}`} class="block bg-bg-elevated border border-border rounded-lg p-4 hover:border-action/30 transition-colors group">
          <div class="flex items-center justify-between mb-1.5">
            <h3 class="text-sm font-semibold text-text-primary group-hover:text-action transition-colors">{t.label}</h3>
            <span class={`text-[10px] font-semibold uppercase tracking-wide px-1.5 py-0.5 rounded ${t.status === 'current' ? 'bg-success/12 text-success' : 'bg-warning/12 text-warning'}`}>
              {t.status}
            </span>
          </div>
          <p class="text-[13px] text-text-secondary line-clamp-2 mb-2">{t.subtitle}</p>
          <div class="flex items-center gap-3 text-[11px] text-text-muted">
            <span>{pluralize(t.pipelineCount, 'pipeline doc')}</span>
          </div>
        </a>
      ))}
    </div>

    <footer class="mt-16 pt-6 border-t border-border">
      <p class="text-xs text-text-muted text-center">Screen Print Pro &mdash; Tools</p>
    </footer>
  </main>
</Layout>
