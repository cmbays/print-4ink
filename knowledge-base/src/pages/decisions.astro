---
import Layout from '../layouts/Layout.astro';
import DecisionRecord from '../components/DecisionRecord.astro';
import { getCollection } from 'astro:content';
import { sortByDateDesc, pluralize } from '../lib/utils';

const docs = await getCollection('pipelines');
const decisions = docs
  .filter((s) => s.data.tags.includes('decision'))
  .sort(sortByDateDesc);
---

<Layout title="Decision Log" description="Key decisions made across the Screen Print Pro project">
  <main class="max-w-[720px] mx-auto px-6 py-12">
    <!-- Back link -->
    <a href="/" class="inline-flex items-center gap-1.5 text-text-muted text-sm hover:text-action transition-colors mb-8">
      <span>&larr;</span> Back to Index
    </a>

    <!-- Header -->
    <h1 class="text-2xl font-bold tracking-tight mb-2">Decision Log</h1>
    <p class="text-text-secondary text-sm mb-2">Key decisions made across the project</p>
    <p class="text-text-muted text-xs mb-8">{pluralize(decisions.length, 'decision')} recorded</p>

    <!-- Decision cards -->
    <div class="space-y-3">
      {decisions.map((doc) => (
        <DecisionRecord
          title={doc.data.title}
          subtitle={doc.data.subtitle}
          date={doc.data.date}
          pipeline={doc.data.pipelineName}
          slug={doc.id}
        />
      ))}
    </div>

    {decisions.length === 0 && (
      <div class="text-center py-16">
        <p class="text-text-muted text-sm">No decisions recorded yet.</p>
      </div>
    )}

    <!-- Footer -->
    <footer class="mt-16 pt-6 border-t border-border">
      <p class="text-xs text-text-muted text-center">
        Screen Print Pro &mdash; Decision Log
      </p>
    </footer>
  </main>
</Layout>
