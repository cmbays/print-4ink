---
interface Props {
  vertical: string;
  totalSessions: number;
  stageBreakdown: Record<string, number>;
  latestDate: Date;
  status: string;
}

const { vertical, totalSessions, stageBreakdown, latestDate, status } = Astro.props;

const verticalLabels: Record<string, string> = {
  quoting: 'Quoting',
  'customer-management': 'Customer Management',
  invoicing: 'Invoicing',
  'price-matrix': 'Price Matrix',
  jobs: 'Jobs',
  'screen-room': 'Screen Room',
  garments: 'Garments',
  dashboard: 'Dashboard',
  meta: 'Meta',
};

const allStages = [
  'research',
  'interview',
  'breadboarding',
  'implementation-planning',
  'build',
  'review',
  'learnings',
];

const coveredStages = allStages.filter((s) => (stageBreakdown[s] || 0) > 0);
const coverageRatio = coveredStages.length / allStages.length;
const dateStr = latestDate.toISOString().split('T')[0];
const label = verticalLabels[vertical] || vertical;
---

<div class="bg-bg-elevated border border-border rounded-lg p-4">
  <div class="flex items-center justify-between mb-3">
    <h3 class="text-[16px] font-semibold text-text-primary">{label}</h3>
    <span
      class:list={[
        'text-[10px] font-semibold uppercase tracking-wide px-2 py-0.5 rounded',
        status === 'Active'
          ? 'bg-success/12 text-success'
          : 'bg-warning/12 text-warning',
      ]}
    >
      {status}
    </span>
  </div>

  <div class="flex items-center gap-3 text-[12px] text-text-muted mb-3">
    <span>{totalSessions} session{totalSessions !== 1 ? 's' : ''}</span>
    <span class="opacity-40">&middot;</span>
    <span>Last active {dateStr}</span>
    <span class="opacity-40">&middot;</span>
    <span>{coveredStages.length}/{allStages.length} stages</span>
  </div>

  {/* Stage progress bar */}
  <div class="flex gap-1">
    {allStages.map((stage) => {
      const hasSessions = (stageBreakdown[stage] || 0) > 0;
      return (
        <div
          class:list={[
            'h-1.5 flex-1 rounded-full',
            hasSessions ? 'bg-action' : 'bg-bg-surface',
          ]}
          title={`${stage}: ${stageBreakdown[stage] || 0} session(s)`}
        />
      );
    })}
  </div>
</div>
