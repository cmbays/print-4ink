---
import { pipelineStageLabelMap, pipelineStageDescriptionMap } from '../lib/utils';

interface StageInfo {
  name: string;
  slug: string;
  count: number;
  active: boolean;
}

interface Props {
  stages: StageInfo[];
  pipeline: string;
}

const { stages, pipeline } = Astro.props;
---

<div class="w-full overflow-x-auto">
  <div class="flex items-start justify-between min-w-[600px] relative py-4">
    {stages.map((stage, i) => {
      const hasContent = stage.count > 0;
      const isActive = stage.active;
      const label = pipelineStageLabelMap[stage.slug] || stage.name;
      const description = pipelineStageDescriptionMap[stage.slug];

      return (
        <div class="flex items-start flex-1">
          {/* Stage node */}
          <a
            href={hasContent ? `/pipelines/${pipeline}/${stage.slug}` : undefined}
            title={description || undefined}
            class:list={[
              'flex flex-col items-center gap-1.5 relative z-10 group',
              hasContent ? 'cursor-pointer' : 'cursor-default',
            ]}
          >
            {/* Circle */}
            <div
              class:list={[
                'w-3.5 h-3.5 rounded-full border-2 transition-colors',
                isActive
                  ? 'bg-action border-action'
                  : hasContent
                    ? 'bg-action/60 border-action/60'
                    : 'bg-transparent border-border',
              ]}
            />

            {/* Label */}
            <span
              class:list={[
                'text-[11px] font-medium text-center leading-tight whitespace-nowrap transition-colors',
                isActive
                  ? 'text-action'
                  : hasContent
                    ? 'text-text-secondary group-hover:text-text-primary'
                    : 'text-text-muted',
              ]}
            >
              {label}
            </span>

            {/* Count badge */}
            {hasContent && (
              <span
                class:list={[
                  'text-[10px] font-semibold px-1.5 py-0.5 rounded-full min-w-[20px] text-center',
                  isActive
                    ? 'bg-action/20 text-action'
                    : 'bg-bg-surface text-text-muted',
                ]}
              >
                {stage.count}
              </span>
            )}

            {!hasContent && (
              <span class="text-[10px] text-text-muted/50 px-1.5 py-0.5">
                0
              </span>
            )}
          </a>

          {/* Connector line */}
          {i < stages.length - 1 && (
            <div class="flex-1 flex items-center pt-[6px]">
              <div
                class:list={[
                  'h-[2px] w-full mx-1',
                  stages[i + 1].count > 0
                    ? 'bg-action/40'
                    : 'bg-border',
                ]}
              />
            </div>
          )}
        </div>
      );
    })}
  </div>
</div>
