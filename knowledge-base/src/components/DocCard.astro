---
import { tagColor, pipelineLabel, stageLabel, formatDate } from '../lib/utils';
import Badge from './Badge.astro';

interface Props {
  title: string;
  subtitle: string;
  date: Date;
  pipeline: string;
  pipelineType?: string;
  stage: string;
  tags: string[];
  status: string;
  slug: string;
}

const { title, subtitle, date, pipeline, pipelineType, stage, tags, status, slug } = Astro.props;

const dateStr = formatDate(date);
---

<a
  href={`/pipelines/${slug}`}
  class="block bg-bg-elevated border border-border rounded-lg p-4 hover:border-action/30 transition-colors group"
>
  <!-- Tags row -->
  <div class="flex items-center gap-1.5 mb-1.5">
    {tags.map((tag) => (
      <Badge colorClass={tagColor(tag)}>{tag}</Badge>
    ))}
    {status === 'in-progress' && (
      <Badge colorClass="bg-warning/12 text-warning" class="ml-auto">In Progress</Badge>
    )}
    {status === 'superseded' && (
      <Badge colorClass="bg-error/12 text-error" class="ml-auto">Superseded</Badge>
    )}
  </div>

  <!-- Title -->
  <h3 class="text-[14px] font-semibold text-text-primary leading-snug group-hover:text-action transition-colors">
    {title}
  </h3>

  <!-- Subtitle -->
  <p class="text-[13px] text-text-secondary mt-0.5 line-clamp-2 leading-relaxed">
    {subtitle}
  </p>

  <!-- Meta row -->
  <div class="flex items-center gap-1.5 mt-2 text-[11px] text-text-muted">
    <span>{dateStr}</span>
    <span class="opacity-40">&middot;</span>
    <span>{pipelineLabel(pipeline)}</span>
    {pipelineType && pipelineType !== 'vertical' && (
      <span class="px-1.5 py-0.5 rounded bg-purple/10 text-purple text-[10px]">
        {pipelineType}
      </span>
    )}
    <span class="opacity-40">&middot;</span>
    <span class="px-1.5 py-0.5 rounded bg-bg-surface text-text-muted text-[10px]">
      {stageLabel(stage)}
    </span>
  </div>
</a>
