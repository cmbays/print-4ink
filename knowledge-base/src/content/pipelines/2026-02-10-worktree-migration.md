---
title: "Git Worktree Migration + Memory Refactoring"
subtitle: "Migrated from git checkout to git worktrees for concurrent session isolation, auto-generated for_human index, and slimmed progress/memory files by 70%."
date: 2026-02-10
phase: 1
vertical: meta
verticalSecondary: []
stage: build
tags: [build, decision]
sessionId: "8a3b9d7b-461c-48a8-bdbc-7b4361c6260a"
branch: "session/0210-worktree-migration"
status: complete
---

## Why

Concurrent Claude Code sessions sharing a single working directory caused file conflicts. The old `git checkout -b` workflow meant only one session could safely edit files at a time. Git worktrees give each session its own isolated directory.

Additionally, `progress.txt` (251 lines) and `MEMORY.md` (202+ lines) were bloated with historical data loaded into every session's context window, wasting tokens.

## What Changed

| Stat | Value |
|------|-------|
| progress.txt lines | 251 → 95 |
| MEMORY.md lines | 202 → 72 |
| gitbutler-lessons.md | 165 → 0 |
| auto-indexed entries | 15 |

### Files Created

- **scripts/generate-for-human-index.js** — Zero-dep Node.js script that scans for_human/*.html, extracts metadata, generates index.html + README.md
- **docs/HISTORY.md** — Archived session logs and completed feature details (moved from progress.txt)
- **memory/worktree-workflow.md** — Detailed worktree rules, stacked PRs, cleanup protocol

### Files Modified

- **progress.txt → PROGRESS.md** — Renamed and slimmed from 251 to 95 lines using collapsible <details> sections
- **CLAUDE.md** — Updated Commands (worktree cmds), Session Startup (worktree workflow), added Hot File Protocol, updated Canonical Docs table, For Human Docs section, Lessons Learned
- **.gitignore** — Added .session-context.md (per-worktree scratchpad)
- **package.json** — Added `gen:index` npm script
- **MEMORY.md** — Refactored from 202 to 72 lines, removed duplication with PROGRESS.md

### Files Deleted

- **memory/gitbutler-lessons.md** — 165 lines of obsolete GitButler CLI commands (removed in PR #40)

## Key Decisions

### Hot File Protocol

PROGRESS.md, for_human/index.html, and for_human/README.md are never committed on feature branches. They're updated on main after PR merge to avoid merge conflicts from concurrent sessions.

### Auto-Generated Index

for_human/index.html and README.md are now generated by `npm run gen:index`. Sessions only commit their individual HTML doc. The script extracts title, subtitle, tags, and date from each file's HTML structure.

### Three-Tier Progress System

PROGRESS.md (active state, ~95 lines) → HISTORY.md (archived details) → MEMORY.md (cross-session patterns, ~72 lines). Each tier serves a different purpose with no duplication.
