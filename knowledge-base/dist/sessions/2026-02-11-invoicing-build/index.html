<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="Full invoicing system — schemas, list page, form, detail view, overlays, and integrations. 30 new files, 8 modified, 314 tests passing."><title>Invoicing Vertical Build &mdash; Screen Print Pro KB</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet"><link rel="stylesheet" href="/_astro/decisions.DGAibQh0.css"></head> <body>  <main class="max-w-[720px] mx-auto px-6 py-12"> <!-- Back link --> <a href="/" class="inline-flex items-center gap-1.5 text-text-muted text-sm hover:text-action transition-colors mb-8"> <span>&larr;</span> Back to Index
</a> <!-- Tag pills --> <div class="flex items-center gap-2 mb-4"> <span class="text-[11px] font-semibold uppercase tracking-wide px-2 py-0.5 rounded bg-success/12 text-success"> feature </span><span class="text-[11px] font-semibold uppercase tracking-wide px-2 py-0.5 rounded bg-success/12 text-success"> build </span> </div> <!-- Title --> <h1 class="text-[28px] font-bold tracking-tight leading-tight mb-2">Invoicing Vertical Build</h1> <!-- Subtitle --> <p class="text-[15px] text-text-secondary leading-relaxed mb-6">Full invoicing system — schemas, list page, form, detail view, overlays, and integrations. 30 new files, 8 modified, 314 tests passing.</p> <!-- Meta grid --> <div class="border border-border rounded-lg overflow-hidden mb-6"> <div class="grid grid-cols-2"> <!-- Row 1 --> <div class="px-4 py-3 border-b border-border"> <div class="text-[11px] font-semibold uppercase tracking-wide text-text-muted mb-1">Date</div> <div class="text-sm text-text-primary">2026-02-11</div> </div> <div class="px-4 py-3 border-b border-border border-l border-border"> <div class="text-[11px] font-semibold uppercase tracking-wide text-text-muted mb-1">Branch</div> <div class="text-sm"> <code class="font-mono text-xs bg-bg-surface px-1.5 py-0.5 rounded text-action">session/0211-invoicing-build</code> </div> </div> <!-- Row 2 --> <div class="px-4 py-3 border-b border-border"> <div class="text-[11px] font-semibold uppercase tracking-wide text-text-muted mb-1">Phase</div> <div class="text-sm text-text-primary">Phase 1</div> </div> <div class="px-4 py-3 border-b border-border border-l border-border"> <div class="text-[11px] font-semibold uppercase tracking-wide text-text-muted mb-1">Vertical</div> <div class="text-sm text-text-primary"> <a href="/verticals/invoicing" class="text-action hover:underline">Invoicing</a>  </div> </div> <!-- Row 3 --> <div class="px-4 py-3"> <div class="text-[11px] font-semibold uppercase tracking-wide text-text-muted mb-1">Stage</div> <div class="text-sm"> <a href="/verticals/invoicing/build" class="inline-flex items-center bg-bg-surface text-action text-xs font-medium px-2 py-0.5 rounded hover:bg-action/10 transition-colors"> Build </a> </div> </div> <div class="px-4 py-3 border-l border-border"> <div class="text-[11px] font-semibold uppercase tracking-wide text-text-muted mb-1">Status</div> <div class="text-sm font-medium text-success"> Complete </div> </div> </div> </div> <!-- Workflow chain --> <div class="mb-6"> <div class="text-[11px] font-semibold uppercase tracking-wide text-text-muted mb-2">Workflow Chain</div> <div class="bg-bg-elevated border border-border rounded-lg px-4 py-2"> <div class="overflow-x-auto"><div class="flex items-center gap-1.5 min-w-max py-2"><a href="/sessions/2026-02-10-invoicing-vertical-research" class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-[12px] border transition-colors whitespace-nowrap bg-bg-surface border-border text-text-secondary hover:text-text-primary hover:border-action/20" title="Invoicing Vertical Research"><span class="font-semibold">Research</span><span class="opacity-60">&middot;</span><span class="opacity-80">Invoicing Vertical Rese…</span></a><span class="text-text-muted text-[11px] select-none">&rarr;</span><a href="/sessions/2026-02-11-invoicing-breadboard" class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-[12px] border transition-colors whitespace-nowrap bg-bg-surface border-border text-text-secondary hover:text-text-primary hover:border-action/20" title="Invoicing Breadboard"><span class="font-semibold">Breadboard</span><span class="opacity-60">&middot;</span><span class="opacity-80">Invoicing Breadboard</span></a><span class="text-text-muted text-[11px] select-none">&rarr;</span><a href="/sessions/2026-02-11-invoicing-build" class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-[12px] border transition-colors whitespace-nowrap bg-action/10 border-action/30 text-action font-medium" title="Invoicing Vertical Build"><span class="font-semibold">Build</span><span class="opacity-60">&middot;</span><span class="opacity-80">Invoicing Vertical Build</span></a></div></div> </div> </div> <!-- Session resume --> <div class="bg-bg-elevated border border-border rounded-lg px-4 py-3 mb-6"> <div class="text-[11px] font-semibold uppercase tracking-wide text-text-muted mb-2">Resume Session</div> <code class="font-mono text-xs text-action select-all">claude --resume ba5ae290-306e-47a6-b09b-c2c10320dad0</code> </div> <!-- PR link -->  <!-- Divider --> <hr class="border-t border-border mb-8"> <!-- Body content --> <div class="prose"> <h2 id="build-summary">Build Summary</h2>

























<table><thead><tr><th>Stat</th><th>Value</th></tr></thead><tbody><tr><td>New Files</td><td>30</td></tr><tr><td>Modified Files</td><td>8</td></tr><tr><td>Tests Passing</td><td>314</td></tr><tr><td>Quality Gate</td><td>10/10</td></tr></tbody></table>
<h2 id="build-phases">Build Phases</h2>
<h3 id="phase-0--data-foundation">Phase 0 — Data Foundation</h3>
<p>Zod schemas for invoices and credit memos. Status state machine (<code>isValidStatusTransition</code>), financial calculators with big.js precision, mock data (8 invoices, 11 payments, 2 credit memos). All math uses <code>money()</code> / <code>round2()</code> / <code>toNumber()</code> — zero floating-point.</p>
<h3 id="phase-1--list-page">Phase 1 — List Page</h3>
<p>Stats bar (outstanding, overdue, paid this month, avg days to pay), smart view tabs (All/Draft/Outstanding/Overdue/Paid), data table with sort, search, batch ops, desktop table + mobile cards, and overdue badge with pulse animation.</p>
<h3 id="phase-2--form--detail-view">Phase 2 — Form + Detail View</h3>
<p>Full invoice form (customer, line items, pricing summary, deposit, payment terms), detail view with payment ledger, reminder timeline, change diff panel, audit log, and context-aware action buttons per status.</p>
<h3 id="phase-3--overlays--edit">Phase 3 — Overlays + Edit</h3>
<p>Record Payment sheet, Send Reminder modal, Void Invoice dialog (destructive, permanent), Create Credit Memo modal (line-item selection, bounded by invoice total), and edit page (draft-only guard).</p>
<h3 id="phase-4--integration-points">Phase 4 — Integration Points</h3>
<p>Sidebar navigation (Receipt icon), Customer detail invoices tab, Quote detail “Create Invoice” button (accepted quotes only), and all cross-vertical navigation wiring.</p>
<h2 id="key-architecture-decisions">Key Architecture Decisions</h2>
<h3 id="bigjs-for-all-financial-arithmetic">big.js for All Financial Arithmetic</h3>
<p>Every monetary calculation goes through <code>lib/helpers/money.ts</code>. Schema invariants use <code>Big.eq()</code> for exact comparison. IEEE 754 floating-point is never used for money — not even for simple addition.</p>
<h3 id="status-state-machine">Status State Machine</h3>
<p><code>isValidStatusTransition()</code> enforces: draft→sent→partial→paid, with void as terminal from any non-paid state. All UI actions check transitions before enabling buttons.</p>
<h3 id="immutability-after-send">Immutability After Send</h3>
<p>Edit page redirects to detail view for non-draft invoices. InvoiceForm rejects non-draft mode. No backdoor to modify sent/partial/paid invoices.</p>
<h3 id="overdue-is-computed-never-stored">Overdue Is Computed, Never Stored</h3>
<p>Single <code>computeIsOverdue()</code> function used everywhere (stats, table, detail, badge). Compares <code>dueDate &#x3C; today AND balanceDue > 0 AND status in [sent, partial]</code>.</p>
<h3 id="conditional-rendering-for-dialog-state">Conditional Rendering for Dialog State</h3>
<p>React 19 ESLint forbids <code>setState</code> in effects. All sheet/dialog components use conditional rendering (<code>{show &#x26;&#x26; &#x3C;Component />}</code>) so React unmounts/remounts, naturally resetting useState hooks.</p>
<h2 id="quality-gate-results">Quality Gate Results</h2>




























































<table><thead><tr><th>#</th><th>Category</th><th>Result</th></tr></thead><tbody><tr><td>1</td><td>Visual Hierarchy</td><td>Pass</td></tr><tr><td>2</td><td>Spacing &#x26; Layout</td><td>Pass</td></tr><tr><td>3</td><td>Typography</td><td>Pass</td></tr><tr><td>4</td><td>Color Usage</td><td>Pass</td></tr><tr><td>5</td><td>Interactive States</td><td>Pass</td></tr><tr><td>6</td><td>Icons</td><td>Pass</td></tr><tr><td>7</td><td>Motion &#x26; Animation</td><td>Pass</td></tr><tr><td>8</td><td>Empty &#x26; Error States</td><td>Pass</td></tr><tr><td>9</td><td>Accessibility</td><td>Pass</td></tr><tr><td>10</td><td>Jobs Filter (Density)</td><td>Pass</td></tr></tbody></table>
<p>Fixes applied during quality gate: <code>font-bold</code>→<code>font-semibold</code> (1), <code>role="alert"</code> additions (2), <code>aria-hidden="true"</code> on decorative icons (3), empty state icon sizes to <code>size-12</code> (2), search no-results now quotes query.</p>
<h2 id="files-created">Files Created</h2>

































































































































<table><thead><tr><th>File</th><th>Phase</th></tr></thead><tbody><tr><td><code>lib/schemas/invoice.ts</code></td><td>0</td></tr><tr><td><code>lib/schemas/credit-memo.ts</code></td><td>0</td></tr><tr><td><code>lib/helpers/invoice-utils.ts</code></td><td>0</td></tr><tr><td><code>lib/helpers/money.ts</code></td><td>0</td></tr><tr><td><code>lib/schemas/__tests__/invoice.test.ts</code></td><td>0</td></tr><tr><td><code>lib/schemas/__tests__/credit-memo.test.ts</code></td><td>0</td></tr><tr><td><code>components/features/OverdueBadge.tsx</code></td><td>1</td></tr><tr><td><code>invoices/page.tsx</code></td><td>1</td></tr><tr><td><code>invoices/_components/InvoiceStatsBar.tsx</code></td><td>1</td></tr><tr><td><code>invoices/_components/InvoicesSmartViewTabs.tsx</code></td><td>1</td></tr><tr><td><code>invoices/_components/InvoicesDataTable.tsx</code></td><td>1</td></tr><tr><td><code>invoices/_components/InvoiceForm.tsx</code></td><td>2</td></tr><tr><td><code>invoices/_components/InvoiceLineItemRow.tsx</code></td><td>2</td></tr><tr><td><code>invoices/_components/InvoicePricingSummary.tsx</code></td><td>2</td></tr><tr><td><code>invoices/_components/DepositSection.tsx</code></td><td>2</td></tr><tr><td><code>invoices/_components/PaymentTermsSection.tsx</code></td><td>2</td></tr><tr><td><code>invoices/new/page.tsx</code></td><td>2</td></tr><tr><td><code>invoices/_components/ReviewSendSheet.tsx</code></td><td>2</td></tr><tr><td><code>invoices/[id]/page.tsx</code></td><td>2</td></tr><tr><td><code>invoices/_components/InvoiceDetailView.tsx</code></td><td>2</td></tr><tr><td><code>invoices/_components/InvoiceActions.tsx</code></td><td>2</td></tr><tr><td><code>invoices/_components/PaymentLedger.tsx</code></td><td>2</td></tr><tr><td><code>invoices/_components/ChangeDiffPanel.tsx</code></td><td>2</td></tr><tr><td><code>invoices/_components/ReminderTimeline.tsx</code></td><td>2</td></tr><tr><td><code>invoices/_components/RecordPaymentSheet.tsx</code></td><td>3</td></tr><tr><td><code>invoices/_components/SendReminderModal.tsx</code></td><td>3</td></tr><tr><td><code>invoices/_components/VoidInvoiceDialog.tsx</code></td><td>3</td></tr><tr><td><code>invoices/_components/CreateCreditMemoModal.tsx</code></td><td>3</td></tr><tr><td><code>invoices/[id]/edit/page.tsx</code></td><td>3</td></tr><tr><td><code>customers/[id]/_components/CustomerInvoicesTable.tsx</code></td><td>4</td></tr></tbody></table>
<h2 id="mock-data-coverage">Mock Data Coverage</h2>



























































<table><thead><tr><th>Invoice</th><th>Status</th><th>Total</th><th>Notes</th></tr></thead><tbody><tr><td>INV-0001</td><td>Paid</td><td>$765</td><td>2 payments (check + square)</td></tr><tr><td>INV-0002</td><td>Sent/Overdue</td><td>$2,614</td><td>Past due 27 days, 1 reminder</td></tr><tr><td>INV-0003</td><td>Draft</td><td>$855</td><td>Deposit requested $427.50</td></tr><tr><td>INV-0004</td><td>Paid</td><td>$1,850</td><td>Holiday merch, 2 payments</td></tr><tr><td>INV-0005</td><td>Partial</td><td>$840</td><td>Deposit received, due in 4d</td></tr><tr><td>INV-0006</td><td>Sent</td><td>$3,200</td><td>Wholesale, due in 17d</td></tr><tr><td>INV-0007</td><td>Partial</td><td>$2,100</td><td>ACH + Zelle, due in 9d</td></tr><tr><td>INV-0008</td><td>Void</td><td>$450</td><td>Customer cancelled</td></tr></tbody></table>
<p>Plus 11 payment records and 2 credit memos covering check, cash, square, venmo, zelle, and ACH methods.</p>
<h2 id="lessons-learned">Lessons Learned</h2>
<h3 id="bigjs-is-non-negotiable-for-financial-ui">big.js Is Non-Negotiable for Financial UI</h3>
<p>Even “display-only” components that compute stats (sums, averages) must use big.js. Floating-point errors compound across 8 invoices with multi-payment ledgers. The <code>money()</code> wrapper makes it painless.</p>
<h3 id="quality-gate-catches-real-issues">Quality Gate Catches Real Issues</h3>
<p>The 10-category audit found 8 fixable issues across typography (<code>font-bold</code>), accessibility (<code>role="alert"</code>, <code>aria-hidden</code>), and empty states (icon sizing). All fixed in 3 commits with zero regressions.</p>
<h3 id="conditional-rendering-beats-useeffect-reset">Conditional Rendering Beats useEffect Reset</h3>
<p>React 19 ESLint flags <code>setState</code> in effects. The pattern <code>{show &#x26;&#x26; &#x3C;Sheet />}</code> is cleaner — unmount/remount naturally resets all hooks. Applied to RecordPaymentSheet, SendReminderModal, VoidInvoiceDialog, and CreateCreditMemoModal.</p>
<hr>
<h2 id="artifacts">Artifacts</h2>
<ul>
<li><strong>PR</strong>: <a href="https://github.com/cmbays/print-4ink/pull/50">#50 — Invoicing vertical build</a></li>
<li><strong>Breadboard</strong>: <code>docs/breadboards/invoicing-breadboard.md</code></li>
<li><strong>Research spikes</strong>: <code>docs/spikes/invoicing-*.md</code> (6 files)</li>
<li><strong>Plan</strong>: <code>.claude/plans/zesty-wibbling-river.md</code></li>
</ul> </div> <!-- Footer --> <footer class="mt-16 pt-6 border-t border-border"> <p class="text-xs text-text-muted text-center">
Screen Print Pro &mdash; Invoicing Vertical Build &mdash; 2026-02-11 </p> </footer> </main>  </body></html>