<!DOCTYPE html>
<html lang="en"
  data-doc-id="session-2026-02-07-ci-testing"
  data-title="CI &amp; Testing Setup"
  data-subtitle="GitHub Actions CI workflow, Vitest schema tests, and mock data UUID fix. Catches build/lint/type/test failures on every push and PR."
  data-date="2026-02-07"
  data-phase="1"
  data-vertical="meta"
  data-vertical-secondary=""
  data-stage="build"
  data-tags="feature,build,learning"
  data-session-id="29d21a39-94a9-4cb3-8ac1-bcc442a85d68"
  data-branch="infra/ci-testing-setup"
  data-pr=""
  data-status="complete"
>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CI &amp; Testing Setup &mdash; Screen Print Pro</title>
  <style>
    :root {
      --bg-primary: #09090b;
      --bg-elevated: #18181b;
      --bg-surface: #1c1c1f;
      --text-primary: rgba(255,255,255,0.87);
      --text-secondary: rgba(255,255,255,0.60);
      --text-muted: rgba(255,255,255,0.38);
      --action: #22d3ee;
      --success: #34d399;
      --error: #f87171;
      --warning: #fbbf24;
      --border: rgba(255,255,255,0.08);
      --font-ui: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      --font-mono: 'JetBrains Mono', 'Fira Code', monospace;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: var(--font-ui);
      line-height: 1.6;
      padding: 48px 24px;
    }

    .container { max-width: 720px; margin: 0 auto; }

    .top-nav { margin-bottom: 24px; }
    .back-btn {
      display: inline-flex; align-items: center; gap: 6px;
      color: var(--text-muted); font-size: 13px; font-weight: 500;
      text-decoration: none; padding: 6px 12px; border-radius: 6px;
      border: 1px solid var(--border); transition: all 0.15s ease;
    }
    .back-btn:hover { color: var(--action); border-color: rgba(34, 211, 238, 0.3); text-decoration: none; }

    header { margin-bottom: 32px; }

    .tag-row { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }
    .tag {
      display: inline-block; font-size: 11px; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.05em;
      padding: 4px 10px; border-radius: 4px;
    }
    .tag-feature,
    .tag-build    { background: rgba(52, 211, 153, 0.12); color: var(--success); }
    .tag-learning { background: rgba(251, 191, 36, 0.12); color: var(--warning); }

    h1 { font-size: 28px; font-weight: 700; letter-spacing: -0.02em; margin-bottom: 8px; }
    .subtitle { color: var(--text-secondary); font-size: 15px; margin-bottom: 20px; }

    .meta-grid {
      display: grid; grid-template-columns: 1fr 1fr; gap: 1px;
      background: var(--border); border: 1px solid var(--border);
      border-radius: 8px; overflow: hidden; margin-bottom: 12px;
    }
    .meta-item { background: var(--bg-elevated); padding: 12px 16px; }
    .meta-label {
      display: block; font-size: 10px; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.05em;
      color: var(--text-muted); margin-bottom: 4px;
    }
    .meta-value { font-size: 13px; color: var(--text-primary); }

    .session-resume {
      background: var(--bg-elevated); border: 1px solid var(--border);
      border-radius: 8px; padding: 12px 16px; margin-bottom: 16px;
    }
    .session-resume code {
      font-family: var(--font-mono); font-size: 12px;
      color: var(--action); user-select: all; cursor: pointer;
    }

    .header-divider { border: none; border-top: 1px solid var(--border); margin: 0 0 32px 0; }

    h2 { font-size: 18px; font-weight: 600; margin-top: 40px; margin-bottom: 16px; letter-spacing: -0.01em; }
    h3 { font-size: 15px; font-weight: 600; margin-top: 24px; margin-bottom: 8px; }
    p, li { font-size: 14px; color: var(--text-secondary); line-height: 1.7; }
    ul, ol { padding-left: 20px; margin-bottom: 16px; }
    li { margin-bottom: 6px; }
    li strong { color: var(--text-primary); }
    a { color: var(--action); text-decoration: none; }
    a:hover { text-decoration: underline; }

    .card {
      background: var(--bg-elevated); border: 1px solid var(--border);
      border-radius: 8px; padding: 20px; margin-bottom: 16px;
    }
    .card-label {
      font-size: 11px; font-weight: 600; text-transform: uppercase;
      letter-spacing: 0.05em; color: var(--text-muted); margin-bottom: 8px;
    }

    table {
      width: 100%; border-collapse: collapse; margin-bottom: 16px; font-size: 13px;
    }
    th {
      text-align: left; font-weight: 600; color: var(--text-muted);
      font-size: 11px; text-transform: uppercase; letter-spacing: 0.05em;
      padding: 8px 12px; border-bottom: 1px solid var(--border);
    }
    td { padding: 10px 12px; border-bottom: 1px solid var(--border); color: var(--text-secondary); }
    td:first-child { color: var(--text-primary); }

    code {
      font-family: var(--font-mono); font-size: 13px;
      background: var(--bg-surface); padding: 2px 6px; border-radius: 4px; color: var(--action);
    }

    .stage-tag {
      display: inline-block;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 2px 8px;
      border-radius: 4px;
      background: rgba(34, 211, 238, 0.1);
      color: var(--action);
    }

    .count-badge {
      display: inline-block; font-size: 12px; font-weight: 600;
      background: rgba(34, 211, 238, 0.1); color: var(--action);
      padding: 2px 8px; border-radius: 4px;
    }
    .bug-badge {
      display: inline-block; font-size: 12px; font-weight: 600;
      background: rgba(248, 113, 113, 0.1); color: var(--error);
      padding: 2px 8px; border-radius: 4px;
    }

    hr { border: none; border-top: 1px solid var(--border); margin: 32px 0; }

    footer {
      margin-top: 48px; padding-top: 24px; border-top: 1px solid var(--border);
      font-size: 12px; color: var(--text-muted); text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">

    <!-- ========== TOP NAV ========== -->
    <nav class="top-nav">
      <a class="back-btn" href="index.html">&larr; Back to Index</a>
    </nav>

    <!-- ========== HEADER ========== -->
    <header>
      <div class="tag-row">
        <span class="tag tag-feature">Feature</span>
        <span class="tag tag-build">Build</span>
        <span class="tag tag-learning">Learning</span>
      </div>

      <h1>CI &amp; Testing Setup</h1>
      <p class="subtitle">GitHub Actions CI workflow, Vitest schema tests, and mock data UUID fix. Catches build/lint/type/test failures on every push and PR.</p>

      <div class="meta-grid">
        <div class="meta-item">
          <span class="meta-label">Date</span>
          <span class="meta-value">2026-02-07</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Branch</span>
          <span class="meta-value"><code>infra/ci-testing-setup</code></span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Phase</span>
          <span class="meta-value">Phase 1 &mdash; Mockup</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Vertical</span>
          <span class="meta-value">Infrastructure</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Stage</span>
          <span class="meta-value"><span class="stage-tag">Build</span></span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Status</span>
          <span class="meta-value">Complete</span>
        </div>
      </div>

      <div class="session-resume">
        <span class="meta-label">Resume Session</span>
        <code>claude --resume 29d21a39-94a9-4cb3-8ac1-bcc442a85d68</code>
      </div>
    </header>

    <hr class="header-divider">

    <!-- ========== BODY CONTENT ========== -->

    <h2>What Was Built</h2>

    <h3>GitHub Actions CI</h3>
    <div class="card">
      <div class="card-label">Pipeline</div>
      <p>Runs on every push/PR to <code>main</code>. Four sequential checks:</p>
      <table>
        <tr><th>Step</th><th>Command</th><th>Catches</th></tr>
        <tr><td>Type check</td><td><code>tsc --noEmit</code></td><td>TypeScript errors</td></tr>
        <tr><td>Lint</td><td><code>eslint</code></td><td>Code quality issues</td></tr>
        <tr><td>Test</td><td><code>vitest run</code></td><td>Schema validation failures</td></tr>
        <tr><td>Build</td><td><code>next build</code></td><td>Broken imports, bad JSX</td></tr>
      </table>
      <p>File: <code>.github/workflows/ci.yml</code></p>
    </div>

    <h3>Vitest Schema Tests</h3>
    <div class="card">
      <div class="card-label">Test Suite &mdash; <span class="count-badge">66 tests</span></div>
      <table>
        <tr><th>File</th><th>Tests</th><th>Validates</th></tr>
        <tr><td>garment.test.ts</td><td>8</td><td>Valid garment, empty strings, negative/fractional sizes</td></tr>
        <tr><td>customer.test.ts</td><td>6</td><td>Valid customer, invalid UUID, invalid email</td></tr>
        <tr><td>job.test.ts</td><td>21</td><td>All 6 production states, 4 priorities, print locations</td></tr>
        <tr><td>quote.test.ts</td><td>14</td><td>All 4 statuses, line items, negative prices, datetime</td></tr>
        <tr><td>screen.test.ts</td><td>10</td><td>All 3 burn statuses, mesh count, UUID validation</td></tr>
        <tr><td>mock-data.test.ts</td><td>7</td><td>All mock data parses, referential integrity (FK links)</td></tr>
      </table>
      <p>Tests live in <code>lib/schemas/__tests__/</code></p>
    </div>

    <hr>

    <h2>Bug Discovered &amp; Fixed</h2>
    <div class="card">
      <div class="card-label"><span class="bug-badge">Bug</span> Mock Data UUIDs Invalid</div>
      <p>The schema tests immediately caught that <strong>8 mock data UUIDs</strong> were not RFC-4122 compliant. Zod v4 validates the full UUID format strictly:</p>
      <ul>
        <li><strong>Version byte</strong> (3rd group): must start with <code>1-8</code></li>
        <li><strong>Variant byte</strong> (4th group): must start with <code>8</code>, <code>9</code>, <code>a</code>, or <code>b</code></li>
      </ul>
      <p>Hand-crafted UUIDs like <code>q1a2b3c4-...</code> and <code>s1a2b3c4-...</code> used non-hex characters (<code>q</code>, <code>s</code>) and invalid variant bytes (<code>0</code>, <code>1</code>, <code>2</code>, <code>3</code>). All 8 were fixed in <code>lib/mock-data.ts</code>.</p>
      <p style="margin-top: 8px; color: var(--text-muted); font-size: 13px;">This validates the decision to test schemas early &mdash; these would have broken Phase 3 backend validation silently.</p>
    </div>

    <hr>

    <h2>Docs Updated</h2>
    <ul>
      <li><code>CLAUDE.md</code> &mdash; Added <code>npm test</code> and <code>npm run test:watch</code> to Commands, Zod UUID lesson to Lessons Learned</li>
      <li><code>docs/TECH_STACK.md</code> &mdash; Added Testing section with Vitest entry</li>
      <li><code>progress.txt</code> &mdash; Added CI + Testing infrastructure and session log</li>
    </ul>

    <hr>

    <h2>Decision Rationale</h2>
    <p>Phase 1 is a UI mockup &mdash; testing strategy is intentionally minimal and targeted:</p>
    <ul>
      <li><strong>Schema tests now</strong>: High ROI &mdash; schemas carry forward to Phase 3 backend. 66 tests cost minutes to write.</li>
      <li><strong>E2E deferred</strong>: UI changes heavily at each checkpoint. Writing Playwright tests now means rewriting after every review.</li>
      <li><strong>Component tests skipped</strong>: The components ARE the deliverable and they're changing rapidly. Negative ROI.</li>
      <li><strong>No Claude Code hooks</strong>: CI catches the same issues asynchronously. Hooks add friction during rapid prototyping.</li>
    </ul>

    <footer>
      Screen Print Pro &mdash; CI &amp; Testing Setup &mdash; 2026-02-07
    </footer>
  </div>
</body>
</html>
