<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>For Human — Screen Print Pro Knowledge Base</title>
  <style>

    :root {
      --bg-primary: #09090b;
      --bg-elevated: #18181b;
      --bg-surface: #1c1c1f;
      --text-primary: rgba(255,255,255,0.87);
      --text-secondary: rgba(255,255,255,0.60);
      --text-muted: rgba(255,255,255,0.38);
      --action: #22d3ee;
      --success: #34d399;
      --error: #f87171;
      --warning: #fbbf24;
      --purple: #a78bfa;
      --border: rgba(255,255,255,0.08);
      --font-ui: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      --font-mono: 'JetBrains Mono', 'Fira Code', monospace;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: var(--font-ui);
      line-height: 1.6;
    }
    a { color: var(--action); text-decoration: none; }
    a:hover { text-decoration: underline; }


    /* --- LAYOUT --- */
    .app {
      display: grid;
      grid-template-columns: 240px 1fr;
      grid-template-rows: auto 1fr;
      min-height: 100vh;
    }

    /* --- TOPBAR --- */
    .topbar {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 12px 24px;
      border-bottom: 1px solid var(--border);
      background: var(--bg-elevated);
    }

    .topbar-badge {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 4px 10px;
      border-radius: 4px;
      background: rgba(34, 211, 238, 0.12);
      color: var(--action);
      white-space: nowrap;
    }

    .topbar-title {
      font-size: 15px;
      font-weight: 600;
      white-space: nowrap;
    }

    .search-box {
      flex: 1;
      max-width: 400px;
      margin-left: auto;
    }

    .search-input {
      width: 100%;
      background: var(--bg-surface);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 8px 12px;
      font-size: 13px;
      color: var(--text-primary);
      font-family: var(--font-ui);
      outline: none;
      transition: border-color 0.15s ease;
    }

    .search-input::placeholder { color: var(--text-muted); }
    .search-input:focus { border-color: rgba(34, 211, 238, 0.4); }

    .phase-filters {
      display: flex;
      gap: 4px;
    }

    .phase-btn {
      background: transparent;
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 4px 10px;
      font-size: 12px;
      font-weight: 500;
      color: var(--text-muted);
      cursor: pointer;
      font-family: var(--font-ui);
      transition: all 0.15s ease;
    }

    .phase-btn:hover { color: var(--text-secondary); border-color: rgba(255,255,255,0.15); }
    .phase-btn.active { background: rgba(34, 211, 238, 0.12); color: var(--action); border-color: rgba(34, 211, 238, 0.3); }

    /* --- SIDEBAR --- */
    .sidebar {
      border-right: 1px solid var(--border);
      background: var(--bg-elevated);
      padding: 16px 0;
      overflow-y: auto;
    }

    .sidebar-section {
      padding: 0 12px;
      margin-bottom: 20px;
    }

    .sidebar-heading {
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      padding: 0 8px;
      margin-bottom: 6px;
    }

    .sidebar-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 6px 8px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.1s ease;
      font-size: 13px;
      color: var(--text-secondary);
      user-select: none;
    }

    .sidebar-item:hover { background: rgba(255,255,255,0.04); }
    .sidebar-item.active { background: rgba(34, 211, 238, 0.08); color: var(--action); }

    .sidebar-count {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      background: rgba(255,255,255,0.04);
      padding: 1px 6px;
      border-radius: 3px;
    }

    .sidebar-item.active .sidebar-count {
      background: rgba(34, 211, 238, 0.12);
      color: var(--action);
    }

    /* --- MAIN CONTENT --- */
    .main {
      padding: 24px;
      overflow-y: auto;
    }

    .main-header {
      margin-bottom: 24px;
    }

    .main-title {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.02em;
      margin-bottom: 4px;
    }

    .main-subtitle {
      font-size: 13px;
      color: var(--text-muted);
    }

    /* --- STAGE PIPELINE --- */
    .pipeline {
      display: flex;
      align-items: center;
      gap: 0;
      margin-bottom: 24px;
      padding: 16px 0;
      overflow-x: auto;
    }

    .pipeline-stage {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      position: relative;
      min-width: 60px;
    }

    .pipeline-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--bg-surface);
      border: 2px solid rgba(255,255,255,0.15);
      transition: all 0.2s ease;
      position: relative;
      z-index: 1;
    }

    .pipeline-stage.complete .pipeline-dot {
      background: var(--success);
      border-color: var(--success);
    }

    .pipeline-stage.in-progress .pipeline-dot {
      background: var(--action);
      border-color: var(--action);
      animation: pulse 2s ease-in-out infinite;
    }

    .pipeline-stage.active .pipeline-dot {
      box-shadow: 0 0 0 3px rgba(34, 211, 238, 0.3);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .pipeline-label {
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      color: var(--text-muted);
      text-align: center;
      white-space: nowrap;
    }

    .pipeline-stage.complete .pipeline-label { color: var(--success); }
    .pipeline-stage.in-progress .pipeline-label { color: var(--action); }
    .pipeline-stage.active .pipeline-label { color: var(--text-primary); }

    .pipeline-count {
      font-size: 9px;
      color: var(--text-muted);
    }

    .pipeline-connector {
      flex: 1;
      height: 2px;
      background: rgba(255,255,255,0.08);
      min-width: 20px;
      margin-top: -18px;
    }

    .pipeline-connector.complete { background: var(--success); opacity: 0.4; }

    /* --- DOCUMENT CARDS --- */
    .doc-list { display: flex; flex-direction: column; gap: 8px; }

    .doc-card {
      display: block;
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 16px 20px;
      transition: border-color 0.15s ease;
      text-decoration: none;
    }

    .doc-card:hover { border-color: rgba(34, 211, 238, 0.3); text-decoration: none; }

    .doc-card-top {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 6px;
    }

    .doc-card-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .doc-card-date {
      font-size: 12px;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .doc-card-subtitle {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .doc-card-meta {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      align-items: center;
    }

    .doc-tag {
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      padding: 2px 7px;
      border-radius: 3px;
    }

    .doc-tag-feature, .doc-tag-build { background: rgba(52, 211, 153, 0.1); color: var(--success); }
    .doc-tag-plan { background: rgba(34, 211, 238, 0.1); color: var(--action); }
    .doc-tag-decision, .doc-tag-learning { background: rgba(251, 191, 36, 0.1); color: var(--warning); }
    .doc-tag-research { background: rgba(167, 139, 250, 0.1); color: var(--purple); }

    .doc-stage-badge {
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      padding: 2px 7px;
      border-radius: 3px;
      background: rgba(34, 211, 238, 0.08);
      color: var(--action);
      opacity: 0.7;
    }

    .doc-vertical-badge {
      font-size: 10px;
      color: var(--text-muted);
    }

    /* --- EMPTY STATE --- */
    .empty-state {
      text-align: center;
      padding: 48px 24px;
      color: var(--text-muted);
    }

    .empty-state-icon {
      font-size: 32px;
      margin-bottom: 12px;
      opacity: 0.3;
    }

    /* --- RESPONSIVE --- */
    @media (max-width: 768px) {
      .app {
        grid-template-columns: 1fr;
      }
      .sidebar {
        display: none;
      }
      .sidebar.mobile-open {
        display: block;
        position: fixed;
        top: 0;
        left: 0;
        width: 280px;
        height: 100vh;
        z-index: 100;
        box-shadow: 4px 0 24px rgba(0,0,0,0.5);
      }
      .topbar-title { display: none; }
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <!-- Topbar -->
    <div class="topbar">
      <span class="topbar-badge">Screen Print Pro</span>
      <span class="topbar-title">Knowledge Base</span>
      <div class="search-box">
        <input type="text" class="search-input" id="search" placeholder="Search docs..." autocomplete="off">
      </div>
      <div class="phase-filters" id="phase-filters">
        <button class="phase-btn active" data-phase="all">All</button>
        <button class="phase-btn" data-phase="1">Phase 1</button>
        <button class="phase-btn" data-phase="2">Phase 2</button>
        <button class="phase-btn" data-phase="3">Phase 3</button>
      </div>
    </div>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
      <div class="sidebar-section">
        <div class="sidebar-heading">Views</div>
        <div class="sidebar-item active" data-view="all">
          <span>All Sessions</span>
          <span class="sidebar-count" id="count-all">23</span>
        </div>
        <div class="sidebar-item" data-view="gary">
          <span>Gary Tracker</span>
          <span class="sidebar-count" id="count-gary">0</span>
        </div>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-heading">Verticals</div>
        <div id="sidebar-verticals"></div>
      </div>
      <div class="sidebar-section">
        <div class="sidebar-heading">Infrastructure</div>
        <div id="sidebar-infra"></div>
      </div>
    </nav>

    <!-- Main -->
    <main class="main" id="main">
      <div class="main-header">
        <div class="main-title" id="main-title">All Sessions</div>
        <div class="main-subtitle" id="main-subtitle">23 documents across 5 verticals</div>
      </div>
      <div id="pipeline-container"></div>
      <div class="doc-list" id="doc-list"></div>
    </main>
  </div>

  <script>
  window.__MANIFEST__ = {"generated":"2026-02-12T23:33:59.946Z","verticals":[{"slug":"quoting","label":"Quoting","order":1,"category":"domain","phases":{"1":{"stages":{"build":{"status":"complete","docCount":2},"research":{"status":"complete","docCount":1},"breadboarding":{"status":"complete","docCount":1}}}}},{"slug":"customer-management","label":"Customer Management","order":2,"category":"domain","phases":{"1":{"stages":{"review":{"status":"complete","docCount":2},"breadboarding":{"status":"complete","docCount":1},"build":{"status":"complete","docCount":1}}}}},{"slug":"invoicing","label":"Invoicing","order":3,"category":"domain","phases":{"1":{"stages":{"build":{"status":"complete","docCount":1},"breadboarding":{"status":"complete","docCount":1},"research":{"status":"complete","docCount":1}}}}},{"slug":"price-matrix","label":"Price Matrix","order":4,"category":"domain","phases":{"1":{"stages":{"build":{"status":"complete","docCount":1},"breadboarding":{"status":"complete","docCount":1},"research":{"status":"complete","docCount":1}}}}},{"slug":"meta","label":"Meta / Infrastructure","order":99,"category":"infra","phases":{"1":{"stages":{"build":{"status":"complete","docCount":7},"implementation-planning":{"status":"complete","docCount":1},"research":{"status":"complete","docCount":1}}}}}],"documents":[{"id":"2026-02-12-price-matrix-build","file":"2026-02-12-price-matrix-build.html","title":"Price Matrix Build","subtitle":"Full implementation of the pricing engine vertical — schemas, editors, Power Grid, sandbox mode, and the useSpreadsheetEditor data grid widget","date":"2026-02-12","phase":1,"vertical":"price-matrix","verticalSecondary":[],"stage":"build","tags":["feature","build","learning"],"sessionId":"c564ffea-778c-43d0-a35f-2bb32431d23b","status":"complete"},{"id":"2026-02-11-price-matrix-breadboard","file":"2026-02-11-price-matrix-breadboard.html","title":"Price Matrix Breadboard","subtitle":"UI affordance map, wiring, component boundaries, and parallelized build order for the Price Matrix vertical","date":"2026-02-11","phase":1,"vertical":"price-matrix","verticalSecondary":[],"stage":"breadboarding","tags":["plan","decision"],"sessionId":"ac42f9fb-92e3-4d10-971d-bec20c749009","status":"complete"},{"id":"2026-02-11-invoicing-build","file":"2026-02-11-invoicing-build.html","title":"Invoicing Vertical Build","subtitle":"Full invoicing system — schemas, list page, form, detail view, overlays, and integrations. 30 new files, 8 modified, 314 tests passing.","date":"2026-02-11","phase":1,"vertical":"invoicing","verticalSecondary":[],"stage":"build","tags":["feature","build"],"sessionId":"ba5ae290-306e-47a6-b09b-c2c10320dad0","status":"complete"},{"id":"2026-02-11-invoicing-breadboard","file":"2026-02-11-invoicing-breadboard.html","title":"Invoicing Breadboard","subtitle":"UI affordances, code affordances, wiring, and component boundaries for the invoicing vertical — the buildable blueprint before code.","date":"2026-02-11","phase":1,"vertical":"invoicing","verticalSecondary":[],"stage":"breadboarding","tags":["plan","research"],"sessionId":"ba5ae290-306e-47a6-b09b-c2c10320dad0","status":"complete"},{"id":"2026-02-10-worktree-migration","file":"2026-02-10-worktree-migration.html","title":"Git Worktree Migration + Memory Refactoring","subtitle":"Migrated from git checkout to git worktrees for concurrent session isolation, auto-generated for_human index, and slimmed progress/memory files by 70%.","date":"2026-02-10","phase":1,"vertical":"meta","verticalSecondary":[],"stage":"build","tags":["build","decision"],"sessionId":"8a3b9d7b-461c-48a8-bdbc-7b4361c6260a","status":"complete"},{"id":"2026-02-10-work-orchestrator","file":"2026-02-10-work-orchestrator.html","title":"work() — Worktree Orchestrator","subtitle":"Single command to create worktrees, tmux sessions, and launch Claude — with Agent Teams integration via tmux hook.","date":"2026-02-10","phase":1,"vertical":"meta","verticalSecondary":[],"stage":"build","tags":["build","feature"],"sessionId":"c2b2fb1b-b94a-4b17-bab0-3616c520c716","status":"complete"},{"id":"2026-02-10-quoting-interconnection","file":"2026-02-10-quoting-interconnection.html","title":"Quoting–Customer Interconnection","subtitle":"Enhanced CustomerCombobox with lifecycle badges, enriched customer context, and cross-vertical search.","date":"2026-02-10","phase":1,"vertical":"quoting","verticalSecondary":["customer-management","invoicing"],"stage":"build","tags":["feature","build"],"sessionId":"633cdbe3-a795-443a-b712-f03c868b4c2e","status":"complete"},{"id":"2026-02-10-price-matrix-research","file":"2026-02-10-price-matrix-research.html","title":"Price Matrix Vertical Research","subtitle":"Comprehensive market research, competitor analysis, and prioritized feature recommendations for the pricing engine vertical","date":"2026-02-10","phase":1,"vertical":"price-matrix","verticalSecondary":[],"stage":"research","tags":["research","plan","decision"],"sessionId":"c2b2fb1b-b94a-4b17-bab0-3616c520c716","status":"complete"},{"id":"2026-02-10-invoicing-vertical-research","file":"2026-02-10-invoicing-vertical-research.html","title":"Invoicing Vertical Research","subtitle":"Comprehensive competitive, UX, integration, compliance, and industry research for the Screen Print Pro invoicing vertical","date":"2026-02-10","phase":1,"vertical":"invoicing","verticalSecondary":[],"stage":"research","tags":["research","plan"],"sessionId":"2e017579-35ba-4702-9fa6-428c2bbcec28","status":"complete"},{"id":"2026-02-10-customer-quality-gate","file":"2026-02-10-customer-quality-gate.html","title":"Customer Management Quality Gate","subtitle":"Comprehensive 5-subagent audit of Customer List + Customer Detail pages. 10 fixes across 11 files.","date":"2026-02-10","phase":1,"vertical":"customer-management","verticalSecondary":[],"stage":"review","tags":["build","feature"],"sessionId":"fb57182f-1dee-41b4-be8c-173b629bb9b1","status":"complete"},{"id":"2026-02-10-customer-mgmt-breadboard","file":"2026-02-10-customer-mgmt-breadboard.html","title":"Customer Management Breadboard","subtitle":"Interactive visualization of Places, Components, Wiring, and Build Order for the Customer Management vertical","date":"2026-02-10","phase":1,"vertical":"customer-management","verticalSecondary":[],"stage":"breadboarding","tags":["plan","build"],"sessionId":"69497710-9bb5-46d9-8e49-949cda0e9d65","status":"complete"},{"id":"2026-02-10-customer-list-page","file":"2026-02-10-customer-list-page.html","title":"Customer List Page","subtitle":"Smart views, search, filters, stats bar, responsive table — the /customers browse experience","date":"2026-02-10","phase":1,"vertical":"customer-management","verticalSecondary":[],"stage":"build","tags":["feature","build"],"sessionId":"b11a4feb-edb5-44ec-89a2-cedd0cb9c591","status":"complete"},{"id":"2026-02-10-customer-feedback","file":"2026-02-10-customer-feedback.html","title":"Customer Management Feedback","subtitle":"8 feedback items from 4Ink owner review. Layout consistency, inline column filters, timeline interactivity, workflow improvements, and code quality refinements.","date":"2026-02-10","phase":1,"vertical":"customer-management","verticalSecondary":[],"stage":"review","tags":["feature","build"],"sessionId":"0ba68ef8-1b02-40be-a039-2c63d6d15cd1","status":"complete"},{"id":"session-2026-02-08-agent-architecture","file":"session-2026-02-08-agent-architecture.html","title":"Agent Architecture","subtitle":"5 specialized agents, 4 new skills, orchestration patterns, and an agent registry. Agents preload skills for domain expertise and chain together for complex workflows.","date":"2026-02-08","phase":1,"vertical":"meta","verticalSecondary":[],"stage":"build","tags":["feature","build"],"sessionId":"5799011a-0503-4ea3-b856-2d19cf66b9ac","status":"complete"},{"id":"2026-02-08-vercel-setup","file":"2026-02-08-vercel-setup.html","title":"Vercel Setup with Access Code Protection","subtitle":"4Ink demo deployment infrastructure","date":"2026-02-08","phase":1,"vertical":"meta","verticalSecondary":[],"stage":"build","tags":["build"],"sessionId":"09b70260-83ac-4830-9b02-ed8c0683f699","status":"complete"},{"id":"2026-02-08-strategic-pivot","file":"2026-02-08-strategic-pivot.html","title":"Strategic Pivot: Vertical-by-Vertical","subtitle":"Moving from linear 10-step implementation plan to user-validated vertical development focused on 4Ink's core pain points.","date":"2026-02-08","phase":1,"vertical":"meta","verticalSecondary":["quoting"],"stage":"implementation-planning","tags":["plan","decision"],"sessionId":"7b394c57-f392-4fb2-87da-1583c256b010","status":"complete"},{"id":"2026-02-08-quoting-discovery","file":"2026-02-08-quoting-discovery.html","title":"Quoting Discovery: Complete","subtitle":"Full competitive analysis, user interview, and improved journey design for the Quoting vertical","date":"2026-02-08","phase":1,"vertical":"quoting","verticalSecondary":[],"stage":"research","tags":["feature","research"],"sessionId":"0fe71069-b9c2-45f3-9a06-5c57de8a013d","status":"complete"},{"id":"2026-02-08-quoting-build","file":"2026-02-08-quoting-build.html","title":"Quoting Vertical Build","subtitle":"Complete implementation of the Quoting vertical — 3 pages, 15+ components, artwork system, flat pricing model, collapsible form sections. Built with parallel agents, polished via CodeRabbit review.","date":"2026-02-08","phase":1,"vertical":"quoting","verticalSecondary":[],"stage":"build","tags":["feature","build"],"sessionId":"13546e08-2ee1-4de3-94a7-c2a596a15e1a","status":"complete"},{"id":"2026-02-08-quoting-breadboard","file":"2026-02-08-quoting-breadboard.html","title":"Quoting Breadboard","subtitle":"Visual blueprint mapping all Places, UI affordances, code affordances, and wiring for the Quoting vertical. Produced by the breadboarding skill as input to the frontend-builder agent.","date":"2026-02-08","phase":1,"vertical":"quoting","verticalSecondary":[],"stage":"breadboarding","tags":["plan","build"],"sessionId":"09b70260-83ac-4830-9b02-ed8c0683f699","status":"complete"},{"id":"2026-02-08-breadboarding-skill","file":"2026-02-08-breadboarding-skill.html","title":"Breadboarding Skill","subtitle":"Promoted breadboarding from Phase 2 deferral to full Phase 1 skill. Maps UI affordances, code affordances, data stores, and wiring before any code is written.","date":"2026-02-08","phase":1,"vertical":"meta","verticalSecondary":["quoting"],"stage":"build","tags":["feature","decision"],"sessionId":"09b70260-83ac-4830-9b02-ed8c0683f699","status":"complete"},{"id":"session-2026-02-07-skills-implementation","file":"session-2026-02-07-skills-implementation.html","title":"Skills Implementation","subtitle":"Built two project-specific Claude Code skills — screen-builder and quality-gate — encoding design system, quality checklist, and domain knowledge into repeatable workflows for all 10 remaining screens.","date":"2026-02-07","phase":1,"vertical":"meta","verticalSecondary":[],"stage":"build","tags":["feature","build"],"sessionId":"58358bf9-61aa-4451-a184-c3d91d1871bd","status":"complete"},{"id":"session-2026-02-07-shaping-skills","file":"session-2026-02-07-shaping-skills.html","title":"Shaping Skills Evaluation","subtitle":"Evaluated Ryan Singer's shaping-skills methodology and extracted three high-value patterns for Screen Print Pro's build process.","date":"2026-02-07","phase":1,"vertical":"meta","verticalSecondary":[],"stage":"research","tags":["decision","research"],"sessionId":"b8b97fce-ca40-4f39-972f-420469febfc5","status":"complete"},{"id":"session-2026-02-07-ci-testing","file":"session-2026-02-07-ci-testing.html","title":"CI \u0026 Testing Setup","subtitle":"GitHub Actions CI workflow, Vitest schema tests, and mock data UUID fix. Catches build/lint/type/test failures on every push and PR.","date":"2026-02-07","phase":1,"vertical":"meta","verticalSecondary":[],"stage":"build","tags":["feature","build","learning"],"sessionId":"29d21a39-94a9-4cb3-8ac1-bcc442a85d68","status":"complete"}],"garyQuestions":[],"stats":{"totalDocs":23,"totalVerticals":5,"garyQuestionsOpen":0,"garyQuestionsTotal":0}};

  (function() {
    var M = window.__MANIFEST__;
    var STAGES = [{"slug":"research","label":"Research","order":1,"short":"Res"},{"slug":"interview","label":"Interview","order":2,"short":"Int"},{"slug":"breadboarding","label":"Breadboarding","order":3,"short":"BB"},{"slug":"implementation-planning","label":"Implementation Planning","order":4,"short":"Plan"},{"slug":"build","label":"Build","order":5,"short":"Build"},{"slug":"review","label":"Review","order":6,"short":"Review"},{"slug":"learnings","label":"Learnings","order":7,"short":"Learn"}];
    var STAGE_MAP = {};
    STAGES.forEach(function(s) { STAGE_MAP[s.slug] = s; });

    // State
    var currentView = 'all';
    var currentVertical = null;
    var currentStage = null;
    var currentPhase = 'all';
    var searchQuery = '';
    var debounceTimer = null;

    // DOM refs
    var searchInput = document.getElementById('search');
    var sidebarVerticals = document.getElementById('sidebar-verticals');
    var sidebarInfra = document.getElementById('sidebar-infra');
    var mainTitle = document.getElementById('main-title');
    var mainSubtitle = document.getElementById('main-subtitle');
    var pipelineContainer = document.getElementById('pipeline-container');
    var docList = document.getElementById('doc-list');
    var countAll = document.getElementById('count-all');

    function escH(s) {
      return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    }

    // --- Render sidebar ---
    function renderSidebar() {
      var domainVerticals = M.verticals.filter(function(v) { return v.category === 'domain'; });
      var infraVerticals = M.verticals.filter(function(v) { return v.category === 'infra'; });

      sidebarVerticals.innerHTML = domainVerticals.map(function(v) {
        var totalCount = M.documents.filter(function(d) { return d.vertical === v.slug; }).length;
        var isActive = currentView === 'vertical' && currentVertical === v.slug;
        return '<div class="sidebar-item' + (isActive ? ' active' : '') + '" data-view="vertical" data-vertical="' + v.slug + '">'
          + '<span>' + escH(v.label) + '</span>'
          + '<span class="sidebar-count">' + totalCount + '</span>'
          + '</div>';
      }).join('');

      sidebarInfra.innerHTML = infraVerticals.map(function(v) {
        var totalCount = M.documents.filter(function(d) { return d.vertical === v.slug; }).length;
        var isActive = currentView === 'vertical' && currentVertical === v.slug;
        return '<div class="sidebar-item' + (isActive ? ' active' : '') + '" data-view="vertical" data-vertical="' + v.slug + '">'
          + '<span>' + escH(v.label) + '</span>'
          + '<span class="sidebar-count">' + totalCount + '</span>'
          + '</div>';
      }).join('');

      // Rebind clicks
      var items = document.querySelectorAll('.sidebar-item');
      for (var i = 0; i < items.length; i++) {
        items[i].addEventListener('click', handleSidebarClick);
      }
    }

    function handleSidebarClick() {
      var view = this.dataset.view;
      var vertical = this.dataset.vertical;

      if (view === 'gary') {
        window.location.href = 'gary-tracker.html';
        return;
      }

      var allItems = document.querySelectorAll('.sidebar-item');
      for (var i = 0; i < allItems.length; i++) { allItems[i].classList.remove('active'); }
      this.classList.add('active');

      if (view === 'all') {
        currentView = 'all';
        currentVertical = null;
        currentStage = null;
      } else if (view === 'vertical') {
        currentView = 'vertical';
        currentVertical = vertical;
        currentStage = null;
      }
      searchQuery = '';
      searchInput.value = '';
      render();
    }

    // --- Filter docs ---
    function getFilteredDocs() {
      var docs = M.documents;

      if (currentPhase !== 'all') {
        docs = docs.filter(function(d) { return String(d.phase) === currentPhase; });
      }

      if (searchQuery) {
        var words = searchQuery.toLowerCase().split(/\s+/).filter(Boolean);
        docs = docs.filter(function(d) {
          var hay = (d.title + ' ' + d.subtitle + ' ' + d.tags.join(' ') + ' ' + d.vertical + ' ' + d.stage).toLowerCase();
          return words.every(function(w) { return hay.indexOf(w) !== -1; });
        });
      } else if (currentView === 'vertical' && currentVertical) {
        docs = docs.filter(function(d) {
          return d.vertical === currentVertical || (d.verticalSecondary && d.verticalSecondary.indexOf(currentVertical) !== -1);
        });
        if (currentStage) {
          docs = docs.filter(function(d) { return d.stage === currentStage; });
        }
      }

      return docs;
    }

    // --- Render pipeline ---
    function renderPipeline() {
      if (currentView !== 'vertical' || !currentVertical) {
        pipelineContainer.innerHTML = '';
        return;
      }

      var vDocs = M.documents.filter(function(d) {
        var matchVertical = d.vertical === currentVertical || (d.verticalSecondary && d.verticalSecondary.indexOf(currentVertical) !== -1);
        var matchPhase = currentPhase === 'all' || String(d.phase) === currentPhase;
        return matchVertical && matchPhase;
      });

      var stageDocCounts = {};
      var stageStatuses = {};
      vDocs.forEach(function(d) {
        stageDocCounts[d.stage] = (stageDocCounts[d.stage] || 0) + 1;
        if (d.status === 'in-progress') stageStatuses[d.stage] = 'in-progress';
        else if (!stageStatuses[d.stage]) stageStatuses[d.stage] = 'complete';
      });

      var html = '<div class="pipeline">';
      var first = true;
      STAGES.forEach(function(stage) {
        var count = stageDocCounts[stage.slug] || 0;
        var status = stageStatuses[stage.slug] || 'future';
        var isActive = currentStage === stage.slug;

        if (!first) {
          var connClass = count > 0 ? ' complete' : '';
          html += '<div class="pipeline-connector' + connClass + '"></div>';
        }
        first = false;

        var stageClass = (count > 0 ? status : 'future') + (isActive ? ' active' : '');
        html += '<div class="pipeline-stage ' + stageClass + '" data-stage="' + stage.slug + '">'
          + '<div class="pipeline-dot"></div>'
          + '<div class="pipeline-label">' + stage.short + '</div>'
          + (count > 0 ? '<div class="pipeline-count">' + count + '</div>' : '')
          + '</div>';
      });
      html += '</div>';
      pipelineContainer.innerHTML = html;

      // Bind pipeline clicks
      var pStages = pipelineContainer.querySelectorAll('.pipeline-stage');
      for (var i = 0; i < pStages.length; i++) {
        pStages[i].addEventListener('click', function() {
          var stage = this.dataset.stage;
          currentStage = (currentStage === stage) ? null : stage;
          render();
        });
      }
    }

    // --- Render doc list ---
    function renderDocList() {
      var docs = getFilteredDocs();

      if (docs.length === 0) {
        docList.innerHTML = '<div class="empty-state">'
          + '<div class="empty-state-icon">&#128269;</div>'
          + '<p>No documents match your filters.</p>'
          + '</div>';
        return;
      }

      docList.innerHTML = docs.map(function(d) {
        // Filter out tags that duplicate the stage (e.g. "build" tag when stage is "build")
        var deduped = d.tags.filter(function(t) { return t !== d.stage; });
        var tags = deduped.map(function(t) { return '<span class="doc-tag doc-tag-' + t + '">' + t + '</span>'; }).join('');
        var stageLabel = STAGE_MAP[d.stage] ? STAGE_MAP[d.stage].short : d.stage;
        var showVertical = currentView === 'all' || searchQuery;

        return '<a class="doc-card" href="' + escH(d.file) + '">'
          + '<div class="doc-card-top">'
          + '<div class="doc-card-title">' + escH(d.title) + '</div>'
          + '<div class="doc-card-date">' + escH(d.date) + '</div>'
          + '</div>'
          + (d.subtitle ? '<div class="doc-card-subtitle">' + escH(d.subtitle) + '</div>' : '')
          + '<div class="doc-card-meta">'
          + tags
          + '<span class="doc-stage-badge">' + escH(stageLabel) + '</span>'
          + (showVertical ? '<span class="doc-vertical-badge">' + escH(d.vertical) + '</span>' : '')
          + '</div>'
          + '</a>';
      }).join('');
    }

    // --- Render header ---
    function renderHeader() {
      var docs = getFilteredDocs();

      if (searchQuery) {
        mainTitle.textContent = 'Search Results';
        mainSubtitle.textContent = docs.length + ' document' + (docs.length !== 1 ? 's' : '') + ' found';
      } else if (currentView === 'vertical' && currentVertical) {
        var vData = M.verticals.find(function(v) { return v.slug === currentVertical; });
        var label = vData ? vData.label : currentVertical;
        mainTitle.textContent = label;
        if (currentStage) {
          var sData = STAGE_MAP[currentStage];
          mainSubtitle.textContent = (sData ? sData.label : currentStage) + ' \u2014 ' + docs.length + ' document' + (docs.length !== 1 ? 's' : '');
        } else {
          mainSubtitle.textContent = docs.length + ' document' + (docs.length !== 1 ? 's' : '') + ' in this vertical';
        }
      } else {
        mainTitle.textContent = 'All Sessions';
        mainSubtitle.textContent = docs.length + ' document' + (docs.length !== 1 ? 's' : '') + ' across ' + M.stats.totalVerticals + ' verticals';
      }

      countAll.textContent = M.documents.filter(function(d) { return currentPhase === 'all' || String(d.phase) === currentPhase; }).length;
    }

    // --- Full render ---
    function render() {
      renderSidebar();
      renderHeader();
      renderPipeline();
      renderDocList();
    }

    // --- Event listeners ---
    searchInput.addEventListener('input', function() {
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(function() {
        searchQuery = searchInput.value.trim();
        if (searchQuery) {
          currentView = 'all';
          currentVertical = null;
          currentStage = null;
          var allItems = document.querySelectorAll('.sidebar-item');
          for (var i = 0; i < allItems.length; i++) { allItems[i].classList.remove('active'); }
        }
        render();
      }, 200);
    });

    document.getElementById('phase-filters').addEventListener('click', function(e) {
      var btn = e.target.closest('.phase-btn');
      if (!btn) return;
      var allBtns = document.querySelectorAll('.phase-btn');
      for (var i = 0; i < allBtns.length; i++) { allBtns[i].classList.remove('active'); }
      btn.classList.add('active');
      currentPhase = btn.dataset.phase;
      render();
    });

    // --- Init ---
    render();
  })();
  </script>
</body>
</html>